import{_ as a,c as i,o as n,a0 as e}from"./chunks/framework.CHkYM5Ax.js";const c=JSON.parse('{"title":"NestBase 使用说明","description":"","frontmatter":{},"headers":[],"relativePath":"guides/USAGE.zh-CN.md","filePath":"guides/USAGE.zh-CN.md","lastUpdated":1766977345000}'),p={name:"guides/USAGE.zh-CN.md"};function l(t,s,h,d,k,o){return n(),i("div",null,[...s[0]||(s[0]=[e(`<h1 id="nestbase-使用说明" tabindex="-1">NestBase 使用说明 <a class="header-anchor" href="#nestbase-使用说明" aria-label="Permalink to &quot;NestBase 使用说明&quot;">​</a></h1><p>本指南面向首次接入与日常运维的同学，涵盖环境准备、安装配置、数据库初始化、开发启动、接口文档、权限使用、部署与故障排查等内容。</p><h2 id="简介" tabindex="-1">简介 <a class="header-anchor" href="#简介" aria-label="Permalink to &quot;简介&quot;">​</a></h2><ul><li>技术栈：NestJS 10、TypeScript 5、Prisma 5、PostgreSQL（Supabase 集成）、JWT、Swagger、class-validator。</li><li>架构：pnpm workspace Monorepo，后端位于 <code>apps/backend</code>，内置统一响应格式、全局异常处理、RBAC + 细粒度权限、菜单系统、OpenAPI 导出。</li></ul><h2 id="环境准备" tabindex="-1">环境准备 <a class="header-anchor" href="#环境准备" aria-label="Permalink to &quot;环境准备&quot;">​</a></h2><ul><li>Node.js ≥ 18</li><li>pnpm ≥ 8（必须）</li><li>PostgreSQL ≥ 14（或 Supabase 项目）</li><li>OpenSSL（建议，用于生成强随机 JWT 密钥）</li></ul><h2 id="安装依赖" tabindex="-1">安装依赖 <a class="header-anchor" href="#安装依赖" aria-label="Permalink to &quot;安装依赖&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 根目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre></div><h2 id="配置环境变量" tabindex="-1">配置环境变量 <a class="header-anchor" href="#配置环境变量" aria-label="Permalink to &quot;配置环境变量&quot;">​</a></h2><p>进入后端目录并复制环境模板：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/backend</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env.example</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env</span></span></code></pre></div><p>按实际情况选择其一进行配置：</p><h3 id="方案-a-supabase-推荐-ipv4-使用连接池-pooler" tabindex="-1">方案 A：Supabase（推荐，IPv4 使用连接池 Pooler） <a class="header-anchor" href="#方案-a-supabase-推荐-ipv4-使用连接池-pooler" aria-label="Permalink to &quot;方案 A：Supabase（推荐，IPv4 使用连接池 Pooler）&quot;">​</a></h3><div class="language-env vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">env</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>NODE_ENV=development</span></span>
<span class="line"><span>PORT=3000</span></span>
<span class="line"><span>API_PREFIX=api</span></span>
<span class="line"><span></span></span>
<span class="line"><span>SUPABASE_URL=https://your-project.supabase.co</span></span>
<span class="line"><span>SUPABASE_ANON_KEY=your-anon-key</span></span>
<span class="line"><span>SUPABASE_SERVICE_ROLE_KEY=your-service-role-key</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 运行时使用连接池（6543）</span></span>
<span class="line"><span>DATABASE_URL=&quot;postgresql://postgres.[ref]:[PASSWORD]@aws-x-region.pooler.supabase.com:6543/postgres?pgbouncer=true&amp;connection_limit=1&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 迁移直连（5432）</span></span>
<span class="line"><span>DIRECT_URL=&quot;postgresql://postgres.[ref]:[PASSWORD]@aws-x-region.pooler.supabase.com:5432/postgres&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>JWT_SECRET=请使用强随机字符串</span></span>
<span class="line"><span>JWT_EXPIRES_IN=7d</span></span></code></pre></div><p>提示：密码含特殊字符需 URL 编码（如 <code>@</code> → <code>%40</code>）。如控制台提示 “Not IPv4 compatible”，必须使用 Pooler。</p><h3 id="方案-b-本地-postgresql" tabindex="-1">方案 B：本地 PostgreSQL <a class="header-anchor" href="#方案-b-本地-postgresql" aria-label="Permalink to &quot;方案 B：本地 PostgreSQL&quot;">​</a></h3><div class="language-env vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">env</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>DATABASE_URL=&quot;postgresql://postgres:postgres@localhost:5432/nestbase&quot;</span></span>
<span class="line"><span>JWT_SECRET=请使用强随机字符串</span></span></code></pre></div><p>生成强随机密钥：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rand</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -base64</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span></span></code></pre></div><h2 id="初始化数据库" tabindex="-1">初始化数据库 <a class="header-anchor" href="#初始化数据库" aria-label="Permalink to &quot;初始化数据库&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 根目录生成 Prisma Client</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma:generate</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 同步 schema（开发快速上手）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/backend</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或标准迁移（团队/生产）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma:migrate</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 种子数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma:seed</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 可视化管理（可选）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma:studio</span></span></code></pre></div><h2 id="启动开发服务器" tabindex="-1">启动开发服务器 <a class="header-anchor" href="#启动开发服务器" aria-label="Permalink to &quot;启动开发服务器&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 方式 1：根目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 方式 2：后端目录</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/backend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span></code></pre></div><p>访问：</p><ul><li>API 服务：<code>http://localhost:3000</code></li><li>Swagger 文档：<code>http://localhost:3000/api-docs</code></li><li>OpenAPI JSON：<code>http://localhost:3000/api/swagger/json</code></li><li>API 统计：<code>http://localhost:3000/api/swagger/stats</code></li></ul><p>Apifox/Postman 导入参见：<code>APIFOX_IMPORT_GUIDE.md</code></p><h2 id="测试账号" tabindex="-1">测试账号 <a class="header-anchor" href="#测试账号" aria-label="Permalink to &quot;测试账号&quot;">​</a></h2><ul><li>管理员+协调员：<code>admin / admin123</code></li><li>普通用户：<code>testuser / user123</code></li><li>协调员：<code>moderator / moderator123</code></li></ul><h2 id="认证与权限快速指南" tabindex="-1">认证与权限快速指南 <a class="header-anchor" href="#认证与权限快速指南" aria-label="Permalink to &quot;认证与权限快速指南&quot;">​</a></h2><ul><li>登录：<code>POST /api/auth/login</code>，响应返回 <code>accessToken</code>。</li><li>鉴权：后续请求在 Header 附带 <code>Authorization: Bearer &lt;token&gt;</code>。</li><li>当前用户：<code>GET /api/auth/profile</code>。</li><li>角色限制：<code>@Roles(Role.ADMIN, Role.MODERATOR)</code>（OR 逻辑）。</li><li>精细权限：<code>@RequirePermissions(&#39;resource.action&#39;)</code>，如 <code>user.create</code>、<code>user.read</code>。</li><li>公共路由：<code>@Public()</code> 标注无需认证的接口。</li></ul><p>为角色分配权限（示例）：</p><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">POST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /api/roles/{roleId}/permissions</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;permissionIds&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;perm-uuid-1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;perm-uuid-2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>角色与用户关联（示例）：</p><ul><li>查看角色用户：<code>GET /api/roles/{id}/users</code></li><li>批量添加：<code>POST /api/roles/{id}/users</code>（传用户 ID 列表）</li><li>批量移除：<code>DELETE /api/roles/{id}/users</code></li></ul><h2 id="主要接口速查" tabindex="-1">主要接口速查 <a class="header-anchor" href="#主要接口速查" aria-label="Permalink to &quot;主要接口速查&quot;">​</a></h2><ul><li>认证：<code>/api/auth/register</code>、<code>/api/auth/login</code>、<code>/api/auth/profile</code></li><li>用户：<code>/api/users</code> 增删改查、<code>/api/users/:id/roles</code> 设置/获取用户角色</li><li>菜单：<code>/api/menus</code>、<code>/api/menus/tree</code>、<code>/api/menus/user-routes</code></li><li>权限：<code>/api/permissions</code> 增删改查、<code>/api/permissions/by-resource</code></li><li>角色：<code>/api/roles</code>、<code>/api/roles/:id/{menus|permissions|users}</code></li></ul><h2 id="常用脚本-根目录" tabindex="-1">常用脚本（根目录） <a class="header-anchor" href="#常用脚本-根目录" aria-label="Permalink to &quot;常用脚本（根目录）&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 开发/构建/启动</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev:backend</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build:backend</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start:prod</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Prisma</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma:generate</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma:migrate</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma:seed</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma:studio</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 质量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lint</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> format</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 清理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clean</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clean:all</span></span></code></pre></div><h2 id="部署" tabindex="-1">部署 <a class="header-anchor" href="#部署" aria-label="Permalink to &quot;部署&quot;">​</a></h2><h3 id="pm2" tabindex="-1">PM2 <a class="header-anchor" href="#pm2" aria-label="Permalink to &quot;PM2&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> i</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pm2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pm2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dist/main.js</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nestbase</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pm2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nestbase</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pm2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nestbase</span></span></code></pre></div><h3 id="docker-推荐在-ci-先构建-dist" tabindex="-1">Docker（推荐在 CI 先构建 dist） <a class="header-anchor" href="#docker-推荐在-ci-先构建-dist" aria-label="Permalink to &quot;Docker（推荐在 CI 先构建 dist）&quot;">​</a></h3><div class="language-dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> node:18-alpine</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /app</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> package*.json ./</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> npm install --production</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dist ./dist</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prisma ./prisma</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> npx prisma generate</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 3000</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;dist/main&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><h2 id="故障排查" tabindex="-1">故障排查 <a class="header-anchor" href="#故障排查" aria-label="Permalink to &quot;故障排查&quot;">​</a></h2><ul><li>数据库连接超时：优先用 Supabase Pooler（6543），确认网络可达。</li><li>认证失败：核对密码并进行 URL 编码（如 <code>@</code>→<code>%40</code>）。</li><li>Prisma 迁移：<code>schema.prisma</code> 确保含 <code>directUrl = env(&quot;DIRECT_URL&quot;)</code>。</li><li>JWT 无效：检查 <code>Authorization</code> 头、<code>JWT_SECRET</code>、服务器时间漂移。</li></ul><h2 id="安全与最佳实践" tabindex="-1">安全与最佳实践 <a class="header-anchor" href="#安全与最佳实践" aria-label="Permalink to &quot;安全与最佳实践&quot;">​</a></h2><ul><li>生产必须使用强随机 <code>JWT_SECRET</code>，并考虑限制 <code>/api-docs</code> 访问。</li><li>登录与敏感接口建议限流（<code>@nestjs/throttler</code>）。</li><li>全局开启 <code>ValidationPipe({ whitelist: true, forbidNonWhitelisted: true, transform: true })</code>。</li><li>守卫区分 401/403；公共路由使用 <code>@Public()</code>。</li><li>DTO 全量校验；路径参数使用 <code>ParseUUIDPipe</code>/<code>ParseIntPipe</code>。</li><li>避免在守卫内频繁 DB 查询，缓存用户权限集合（TTL）。</li></ul><h2 id="目录结构速览" tabindex="-1">目录结构速览 <a class="header-anchor" href="#目录结构速览" aria-label="Permalink to &quot;目录结构速览&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>nestbase/</span></span>
<span class="line"><span>├── apps/</span></span>
<span class="line"><span>│   ├── backend/</span></span>
<span class="line"><span>│   │   ├── src/</span></span>
<span class="line"><span>│   │   │   ├── common/ (decorators/guards/interceptors/filters)</span></span>
<span class="line"><span>│   │   │   ├── modules/ (prisma/auth/users/...)</span></span>
<span class="line"><span>│   │   │   ├── config/</span></span>
<span class="line"><span>│   │   │   ├── app.module.ts</span></span>
<span class="line"><span>│   │   │   └── main.ts</span></span>
<span class="line"><span>│   │   ├── prisma/ (schema.prisma, seed.ts)</span></span>
<span class="line"><span>│   │   └── .env.example</span></span>
<span class="line"><span>└── packages/ ...</span></span></code></pre></div><h2 id="版本要点" tabindex="-1">版本要点 <a class="header-anchor" href="#版本要点" aria-label="Permalink to &quot;版本要点&quot;">​</a></h2><ul><li>v1.2.0：用户多角色支持（<code>roles: Role[]</code>）、头像字段、密码自动排除。</li><li>v1.3.0：菜单模块，树形结构与按角色授权。</li><li>v1.4.0：细粒度权限系统（<code>resource.action</code>）、角色/权限管理与分配接口完善。</li></ul>`,51)])])}const g=a(p,[["render",l]]);export{c as __pageData,g as default};
