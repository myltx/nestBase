import{_ as i,c as a,o as n,a0 as t}from"./chunks/framework.CHkYM5Ax.js";const E=JSON.parse('{"title":"Token åˆ·æ–°å’Œé€€å‡ºç™»å½•åŠŸèƒ½å®æ–½æ€»ç»“","description":"","frontmatter":{},"headers":[],"relativePath":"backend/features/TOKEN_IMPLEMENTATION_SUMMARY.md","filePath":"backend/features/TOKEN_IMPLEMENTATION_SUMMARY.md","lastUpdated":1762852082000}'),l={name:"backend/features/TOKEN_IMPLEMENTATION_SUMMARY.md"};function e(h,s,p,k,r,o){return n(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="token-åˆ·æ–°å’Œé€€å‡ºç™»å½•åŠŸèƒ½å®æ–½æ€»ç»“" tabindex="-1">Token åˆ·æ–°å’Œé€€å‡ºç™»å½•åŠŸèƒ½å®æ–½æ€»ç»“ <a class="header-anchor" href="#token-åˆ·æ–°å’Œé€€å‡ºç™»å½•åŠŸèƒ½å®æ–½æ€»ç»“" aria-label="Permalink to &quot;Token åˆ·æ–°å’Œé€€å‡ºç™»å½•åŠŸèƒ½å®æ–½æ€»ç»“&quot;">â€‹</a></h1><h2 id="âœ…-å®æ–½å®Œæˆç¡®è®¤" tabindex="-1">âœ… å®æ–½å®Œæˆç¡®è®¤ <a class="header-anchor" href="#âœ…-å®æ–½å®Œæˆç¡®è®¤" aria-label="Permalink to &quot;âœ… å®æ–½å®Œæˆç¡®è®¤&quot;">â€‹</a></h2><p><strong>å®æ–½æ—¥æœŸ</strong>: 2025-11-05 <strong>ç‰ˆæœ¬</strong>: v1.6.0 <strong>æäº¤å“ˆå¸Œ</strong>: 9f9dc0d</p><hr><h2 id="ğŸ“‹-åŠŸèƒ½æ¸…å•" tabindex="-1">ğŸ“‹ åŠŸèƒ½æ¸…å• <a class="header-anchor" href="#ğŸ“‹-åŠŸèƒ½æ¸…å•" aria-label="Permalink to &quot;ğŸ“‹ åŠŸèƒ½æ¸…å•&quot;">â€‹</a></h2><h3 id="_1-åŒ-token-æœºåˆ¶-âœ…" tabindex="-1">1. åŒ Token æœºåˆ¶ âœ… <a class="header-anchor" href="#_1-åŒ-token-æœºåˆ¶-âœ…" aria-label="Permalink to &quot;1. åŒ Token æœºåˆ¶ âœ…&quot;">â€‹</a></h3><p>å·²æˆåŠŸå®ç° Access Token + Refresh Token åŒ Token è®¤è¯æœºåˆ¶ï¼š</p><table tabindex="0"><thead><tr><th>Token ç±»å‹</th><th>é»˜è®¤æœ‰æ•ˆæœŸ</th><th>ç”¨é€”</th><th>ç¯å¢ƒå˜é‡</th></tr></thead><tbody><tr><td>Access Token</td><td>15 åˆ†é’Ÿ</td><td>API è®¿é—®è®¤è¯</td><td><code>JWT_ACCESS_EXPIRES_IN</code></td></tr><tr><td>Refresh Token</td><td>7 å¤©</td><td>åˆ·æ–° Access Token</td><td><code>JWT_REFRESH_EXPIRES_IN</code></td></tr></tbody></table><h3 id="_2-æ–°å¢æ¥å£-âœ…" tabindex="-1">2. æ–°å¢æ¥å£ âœ… <a class="header-anchor" href="#_2-æ–°å¢æ¥å£-âœ…" aria-label="Permalink to &quot;2. æ–°å¢æ¥å£ âœ…&quot;">â€‹</a></h3><h4 id="post-api-auth-refresh" tabindex="-1">POST /api/auth/refresh <a class="header-anchor" href="#post-api-auth-refresh" aria-label="Permalink to &quot;POST /api/auth/refresh&quot;">â€‹</a></h4><ul><li><strong>æƒé™</strong>: å…¬å¼€æ¥å£</li><li><strong>åŠŸèƒ½</strong>: ä½¿ç”¨ Refresh Token è·å–æ–°çš„ Token å¯¹</li><li><strong>æ–‡ä»¶</strong>: <code>src/modules/auth/auth.controller.ts:72-105</code></li></ul><h4 id="post-api-auth-logout" tabindex="-1">POST /api/auth/logout <a class="header-anchor" href="#post-api-auth-logout" aria-label="Permalink to &quot;POST /api/auth/logout&quot;">â€‹</a></h4><ul><li><strong>æƒé™</strong>: éœ€è¦è®¤è¯</li><li><strong>åŠŸèƒ½</strong>: é€€å‡ºç™»å½•ï¼ˆå®¢æˆ·ç«¯åˆ é™¤ Tokenï¼‰</li><li><strong>æ–‡ä»¶</strong>: <code>src/modules/auth/auth.controller.ts:107-125</code></li></ul><h3 id="_3-æ›´æ–°çš„æ¥å£-âœ…" tabindex="-1">3. æ›´æ–°çš„æ¥å£ âœ… <a class="header-anchor" href="#_3-æ›´æ–°çš„æ¥å£-âœ…" aria-label="Permalink to &quot;3. æ›´æ–°çš„æ¥å£ âœ…&quot;">â€‹</a></h3><h4 id="post-api-auth-login" tabindex="-1">POST /api/auth/login <a class="header-anchor" href="#post-api-auth-login" aria-label="Permalink to &quot;POST /api/auth/login&quot;">â€‹</a></h4><p><strong>è¿”å›æ•°æ®ç»“æ„</strong>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;email&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;userName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;roles&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;accessToken&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âœ… è¿”å›</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;refreshToken&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âœ… è¿”å›</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;expiresIn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;15m&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // âœ… è¿”å›</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="post-api-auth-register" tabindex="-1">POST /api/auth/register <a class="header-anchor" href="#post-api-auth-register" aria-label="Permalink to &quot;POST /api/auth/register&quot;">â€‹</a></h4><p><strong>è¿”å›æ•°æ®ç»“æ„</strong>: ä¸ç™»å½•æ¥å£ç›¸åŒï¼ŒåŒ…å«å®Œæ•´çš„ token å¯¹è±¡</p><hr><h2 id="ğŸ”-ä»£ç éªŒè¯" tabindex="-1">ğŸ” ä»£ç éªŒè¯ <a class="header-anchor" href="#ğŸ”-ä»£ç éªŒè¯" aria-label="Permalink to &quot;ğŸ” ä»£ç éªŒè¯&quot;">â€‹</a></h2><h3 id="generatetoken-æ–¹æ³•éªŒè¯" tabindex="-1">generateToken() æ–¹æ³•éªŒè¯ <a class="header-anchor" href="#generatetoken-æ–¹æ³•éªŒè¯" aria-label="Permalink to &quot;generateToken() æ–¹æ³•éªŒè¯&quot;">â€‹</a></h3><p><strong>æ–‡ä»¶</strong>: <code>src/modules/auth/auth.service.ts:235-261</code></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">private async </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generateToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(user: any) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> payload</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sub: user.id,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    email: user.email,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    userName: user.userName,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    roles: user.roles,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // âœ… ç”Ÿæˆ Access Token</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> accessToken</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.jwtService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sign</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(payload, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    expiresIn: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.configService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;JWT_ACCESS_EXPIRES_IN&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;15m&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // âœ… ç”Ÿæˆ Refresh Token</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> refreshToken</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.jwtService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sign</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { sub: user.id, type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;refresh&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      expiresIn: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.configService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;JWT_REFRESH_EXPIRES_IN&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;7d&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // âœ… è¿”å›å®Œæ•´çš„ token å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    accessToken,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    refreshToken,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    expiresIn: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.configService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;JWT_ACCESS_EXPIRES_IN&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;15m&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="login-æ–¹æ³•éªŒè¯" tabindex="-1">login() æ–¹æ³•éªŒè¯ <a class="header-anchor" href="#login-æ–¹æ³•éªŒè¯" aria-label="Permalink to &quot;login() æ–¹æ³•éªŒè¯&quot;">â€‹</a></h3><p><strong>æ–‡ä»¶</strong>: <code>src/modules/auth/auth.service.ts:160-230</code></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">async </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">login</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(loginDto: LoginDto) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ... éªŒè¯ç”¨æˆ· ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> roles</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user.userRoles.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ur</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ur.role.code);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // âœ… è°ƒç”¨ generateToken ç”Ÿæˆå®Œæ•´çš„ token å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generateToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user, roles });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // âœ… è¿”å›åŒ…å« token å¯¹è±¡çš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    user: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      id: user.id,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      email: user.email,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      userName: user.userName,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ... å…¶ä»–ç”¨æˆ·ä¿¡æ¯ ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      roles,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    token,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âœ… åŒ…å« accessToken å’Œ refreshToken</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="register-æ–¹æ³•éªŒè¯" tabindex="-1">register() æ–¹æ³•éªŒè¯ <a class="header-anchor" href="#register-æ–¹æ³•éªŒè¯" aria-label="Permalink to &quot;register() æ–¹æ³•éªŒè¯&quot;">â€‹</a></h3><p><strong>æ–‡ä»¶</strong>: <code>src/modules/auth/auth.service.ts:33-155</code></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">async </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(registerDto: RegisterDto) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ... åˆ›å»ºç”¨æˆ· ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> roles</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user.userRoles.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ur</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ur.role.code);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // âœ… è°ƒç”¨ generateToken ç”Ÿæˆå®Œæ•´çš„ token å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generateToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user, roles });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // âœ… è¿”å›åŒ…å« token å¯¹è±¡çš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    user: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ... ç”¨æˆ·ä¿¡æ¯ ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      roles,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    token,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âœ… åŒ…å« accessToken å’Œ refreshToken</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="âœ…-ç»“è®º" tabindex="-1">âœ… ç»“è®º <a class="header-anchor" href="#âœ…-ç»“è®º" aria-label="Permalink to &quot;âœ… ç»“è®º&quot;">â€‹</a></h2><h3 id="ç™»å½•å’Œæ³¨å†Œæ¥å£ç¡®è®¤è¿”å›-refreshtoken" tabindex="-1">ç™»å½•å’Œæ³¨å†Œæ¥å£ç¡®è®¤è¿”å› refreshToken <a class="header-anchor" href="#ç™»å½•å’Œæ³¨å†Œæ¥å£ç¡®è®¤è¿”å›-refreshtoken" aria-label="Permalink to &quot;ç™»å½•å’Œæ³¨å†Œæ¥å£ç¡®è®¤è¿”å› refreshToken&quot;">â€‹</a></h3><p><strong>éªŒè¯ç»“æœ</strong>: âœ… <strong>å·²ç¡®è®¤</strong></p><ol><li>âœ… <code>generateToken()</code> æ–¹æ³•ç”Ÿæˆå¹¶è¿”å› <code>accessToken</code> å’Œ <code>refreshToken</code></li><li>âœ… <code>login()</code> æ–¹æ³•è°ƒç”¨ <code>generateToken()</code> å¹¶è¿”å›å®Œæ•´çš„ token å¯¹è±¡</li><li>âœ… <code>register()</code> æ–¹æ³•è°ƒç”¨ <code>generateToken()</code> å¹¶è¿”å›å®Œæ•´çš„ token å¯¹è±¡</li><li>âœ… å…¨å±€æ‹¦æˆªå™¨å°†å“åº”åŒ…è£…åœ¨ <code>{ success: true, data: {...} }</code> ä¸­</li></ol><h3 id="é¢„æœŸçš„ç™»å½•å“åº”" tabindex="-1">é¢„æœŸçš„ç™»å½•å“åº” <a class="header-anchor" href="#é¢„æœŸçš„ç™»å½•å“åº”" aria-label="Permalink to &quot;é¢„æœŸçš„ç™»å½•å“åº”&quot;">â€‹</a></h3><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user-uuid&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;email&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;admin@example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;userName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;admin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;nickName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ç®¡ç†å‘˜&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;firstName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;lastName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;phone&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;gender&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;avatar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;createdAt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2025-11-05T...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;roles&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ADMIN&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MODERATOR&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;accessToken&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;refreshToken&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;expiresIn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;15m&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="ğŸ“-ç›¸å…³æ–‡ä»¶" tabindex="-1">ğŸ“ ç›¸å…³æ–‡ä»¶ <a class="header-anchor" href="#ğŸ“-ç›¸å…³æ–‡ä»¶" aria-label="Permalink to &quot;ğŸ“ ç›¸å…³æ–‡ä»¶&quot;">â€‹</a></h2><h3 id="æ ¸å¿ƒæ–‡ä»¶" tabindex="-1">æ ¸å¿ƒæ–‡ä»¶ <a class="header-anchor" href="#æ ¸å¿ƒæ–‡ä»¶" aria-label="Permalink to &quot;æ ¸å¿ƒæ–‡ä»¶&quot;">â€‹</a></h3><ul><li>âœ… <code>src/modules/auth/auth.service.ts</code> - è®¤è¯æœåŠ¡ï¼ˆåŒ…å« token ç”Ÿæˆé€»è¾‘ï¼‰</li><li>âœ… <code>src/modules/auth/auth.controller.ts</code> - è®¤è¯æ§åˆ¶å™¨ï¼ˆåŒ…å« refresh å’Œ logout æ¥å£ï¼‰</li><li>âœ… <code>src/modules/auth/dto/refresh-token.dto.ts</code> - Refresh Token DTO</li><li>âœ… <code>src/modules/auth/dto/index.ts</code> - DTO å¯¼å‡º</li></ul><h3 id="é…ç½®æ–‡ä»¶" tabindex="-1">é…ç½®æ–‡ä»¶ <a class="header-anchor" href="#é…ç½®æ–‡ä»¶" aria-label="Permalink to &quot;é…ç½®æ–‡ä»¶&quot;">â€‹</a></h3><ul><li>âœ… <code>.env</code> - ç¯å¢ƒå˜é‡é…ç½® <ul><li><code>JWT_SECRET</code> - JWT å¯†é’¥</li><li><code>JWT_ACCESS_EXPIRES_IN=15m</code> - Access Token æœ‰æ•ˆæœŸ</li><li><code>JWT_REFRESH_EXPIRES_IN=7d</code> - Refresh Token æœ‰æ•ˆæœŸ</li></ul></li><li>âœ… <code>.env.example</code> - ç¯å¢ƒå˜é‡ç¤ºä¾‹</li></ul><h3 id="æ–‡æ¡£æ–‡ä»¶" tabindex="-1">æ–‡æ¡£æ–‡ä»¶ <a class="header-anchor" href="#æ–‡æ¡£æ–‡ä»¶" aria-label="Permalink to &quot;æ–‡æ¡£æ–‡ä»¶&quot;">â€‹</a></h3><ul><li>âœ… <code>TOKEN_REFRESH_LOGOUT.md</code> - Token åˆ·æ–°å’Œé€€å‡ºç™»å½•å®Œæ•´æ–‡æ¡£</li><li>âœ… <code>REDIS_ANALYSIS.md</code> - Redis é›†æˆéœ€æ±‚åˆ†æï¼ˆåæœŸå‚è€ƒï¼‰</li></ul><hr><h2 id="ğŸ›-å·²çŸ¥é—®é¢˜" tabindex="-1">ğŸ› å·²çŸ¥é—®é¢˜ <a class="header-anchor" href="#ğŸ›-å·²çŸ¥é—®é¢˜" aria-label="Permalink to &quot;ğŸ› å·²çŸ¥é—®é¢˜&quot;">â€‹</a></h2><h3 id="æ•°æ®åº“è¿æ¥é—®é¢˜" tabindex="-1">æ•°æ®åº“è¿æ¥é—®é¢˜ <a class="header-anchor" href="#æ•°æ®åº“è¿æ¥é—®é¢˜" aria-label="Permalink to &quot;æ•°æ®åº“è¿æ¥é—®é¢˜&quot;">â€‹</a></h3><p><strong>é—®é¢˜æè¿°</strong>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>PrismaClientInitializationError: Can&#39;t reach database server at</span></span>
<span class="line"><span>aws-1-ap-northeast-1.pooler.supabase.com:6543</span></span></code></pre></div><p><strong>åŸå› åˆ†æ</strong>:</p><ol><li>ç½‘ç»œè¿æ¥é—®é¢˜ï¼ˆæš‚æ—¶æ€§ï¼‰</li><li>Supabase æœåŠ¡æš‚æ—¶ä¸å¯è¾¾</li><li>è¿æ¥æ± é…ç½®è¿‡å°ï¼ˆå·²ä» <code>connection_limit=1</code> è°ƒæ•´ä¸º <code>connection_limit=5</code>ï¼‰</li></ol><p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p><ul><li>âœ… å·²å°† <code>connection_limit</code> ä» 1 å¢åŠ åˆ° 5</li><li>å»ºè®®æ£€æŸ¥ç½‘ç»œè¿æ¥</li><li>å»ºè®®éªŒè¯ Supabase æœåŠ¡çŠ¶æ€</li></ul><p><strong>é…ç½®æ›´æ–°</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ—§é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DATABASE_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;...?pgbouncer=true&amp;connection_limit=1&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ–°é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DATABASE_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;...?pgbouncer=true&amp;connection_limit=5&quot;</span></span></code></pre></div><hr><h2 id="ğŸ§ª-æµ‹è¯•æ–¹æ³•" tabindex="-1">ğŸ§ª æµ‹è¯•æ–¹æ³• <a class="header-anchor" href="#ğŸ§ª-æµ‹è¯•æ–¹æ³•" aria-label="Permalink to &quot;ğŸ§ª æµ‹è¯•æ–¹æ³•&quot;">â€‹</a></h2><h3 id="æ–¹æ³•-1-ä½¿ç”¨-swagger-ui" tabindex="-1">æ–¹æ³• 1: ä½¿ç”¨ Swagger UI <a class="header-anchor" href="#æ–¹æ³•-1-ä½¿ç”¨-swagger-ui" aria-label="Permalink to &quot;æ–¹æ³• 1: ä½¿ç”¨ Swagger UI&quot;">â€‹</a></h3><ol><li>å¯åŠ¨æœåŠ¡ï¼š<code>pnpm dev</code></li><li>è®¿é—®ï¼š<code>http://localhost:9423/api-docs</code></li><li>æµ‹è¯•ç™»å½•æ¥å£ï¼š<code>POST /api/auth/login</code></li><li>æŸ¥çœ‹å“åº”ä¸­çš„ <code>token</code> å¯¹è±¡ï¼Œç¡®è®¤åŒ…å« <code>refreshToken</code></li></ol><h3 id="æ–¹æ³•-2-ä½¿ç”¨-curl" tabindex="-1">æ–¹æ³• 2: ä½¿ç”¨ cURL <a class="header-anchor" href="#æ–¹æ³•-2-ä½¿ç”¨-curl" aria-label="Permalink to &quot;æ–¹æ³• 2: ä½¿ç”¨ cURL&quot;">â€‹</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç™»å½•</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:9423/api/auth/login</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Content-Type: application/json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;userName&quot;:&quot;admin@example.com&quot;,&quot;password&quot;:&quot;admin123&quot;}&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> jq</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆ·æ–° Token</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:9423/api/auth/refresh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Content-Type: application/json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;refreshToken&quot;:&quot;YOUR_REFRESH_TOKEN&quot;}&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> jq</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é€€å‡ºç™»å½•</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:9423/api/auth/logout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer YOUR_ACCESS_TOKEN&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> jq</span></span></code></pre></div><h3 id="æ–¹æ³•-3-ä½¿ç”¨-postman-insomnia" tabindex="-1">æ–¹æ³• 3: ä½¿ç”¨ Postman/Insomnia <a class="header-anchor" href="#æ–¹æ³•-3-ä½¿ç”¨-postman-insomnia" aria-label="Permalink to &quot;æ–¹æ³• 3: ä½¿ç”¨ Postman/Insomnia&quot;">â€‹</a></h3><p>å¯¼å…¥ OpenAPI æ–‡æ¡£ï¼š<code>http://localhost:9423/api-docs-json</code></p><hr><h2 id="ğŸ“Š-æ•°æ®åº“è¿æ¥æ± é…ç½®å»ºè®®" tabindex="-1">ğŸ“Š æ•°æ®åº“è¿æ¥æ± é…ç½®å»ºè®® <a class="header-anchor" href="#ğŸ“Š-æ•°æ®åº“è¿æ¥æ± é…ç½®å»ºè®®" aria-label="Permalink to &quot;ğŸ“Š æ•°æ®åº“è¿æ¥æ± é…ç½®å»ºè®®&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th>ç¯å¢ƒ</th><th>è¿æ¥é™åˆ¶</th><th>è¶…æ—¶æ—¶é—´</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>å¼€å‘ç¯å¢ƒ</strong></td><td>5-10</td><td>10s</td><td>å•å¼€å‘è€…ï¼Œè¿æ¥æ•°å°‘</td></tr><tr><td><strong>æµ‹è¯•ç¯å¢ƒ</strong></td><td>10-20</td><td>10s</td><td>å¤šä¸ªæµ‹è¯•å¹¶å‘</td></tr><tr><td><strong>ç”Ÿäº§ç¯å¢ƒ</strong></td><td>20-50</td><td>30s</td><td>é«˜å¹¶å‘åœºæ™¯</td></tr></tbody></table><p><strong>å½“å‰é…ç½®</strong>: <code>connection_limit=5</code>ï¼ˆå¼€å‘ç¯å¢ƒï¼‰</p><hr><h2 id="ğŸ¯-åç»­ä¼˜åŒ–å»ºè®®" tabindex="-1">ğŸ¯ åç»­ä¼˜åŒ–å»ºè®® <a class="header-anchor" href="#ğŸ¯-åç»­ä¼˜åŒ–å»ºè®®" aria-label="Permalink to &quot;ğŸ¯ åç»­ä¼˜åŒ–å»ºè®®&quot;">â€‹</a></h2><ol><li><p><strong>Redis é›†æˆ</strong>ï¼ˆå‚è€ƒ <code>REDIS_ANALYSIS.md</code>ï¼‰</p><ul><li>Token é»‘åå•ï¼ˆçœŸæ­£çš„æœåŠ¡ç«¯å¤±æ•ˆï¼‰</li><li>Refresh Token ç™½åå•ï¼ˆé™åˆ¶è®¾å¤‡æ•°é‡ï¼‰</li><li>åˆ†å¸ƒå¼é™æµ</li></ul></li><li><p><strong>å®¡è®¡æ—¥å¿—é›†æˆ</strong></p><ul><li>è®°å½•ç™»å½•/åˆ·æ–°/é€€å‡ºæ“ä½œ</li><li>ä½¿ç”¨å·²å®ç°çš„ AuditModule</li></ul></li><li><p><strong>ç›‘æ§å‘Šè­¦</strong></p><ul><li>Token åˆ·æ–°å¤±è´¥ç‡</li><li>ç™»å½•å¤±è´¥æ¬¡æ•°</li><li>æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ç‡</li></ul></li><li><p><strong>å®‰å…¨å¢å¼º</strong></p><ul><li>å®ç°è®¾å¤‡æŒ‡çº¹è¯†åˆ«</li><li>IP åœ°å€é™åˆ¶</li><li>å¼‚å¸¸ç™»å½•æ£€æµ‹</li></ul></li></ol><hr><h2 id="ğŸ“-git-æäº¤è®°å½•" tabindex="-1">ğŸ“ Git æäº¤è®°å½• <a class="header-anchor" href="#ğŸ“-git-æäº¤è®°å½•" aria-label="Permalink to &quot;ğŸ“ Git æäº¤è®°å½•&quot;">â€‹</a></h2><p><strong>æäº¤ä¿¡æ¯</strong>: <code>feat(auth): âœ¨ å®ç° Token åˆ·æ–°å’Œé€€å‡ºç™»å½•åŠŸèƒ½</code></p><p><strong>æäº¤å†…å®¹</strong>:</p><ul><li>6 ä¸ªæ–‡ä»¶ä¿®æ”¹/æ–°å¢</li><li>æ–°å¢ 639 è¡Œä»£ç </li><li>åŒ…å«å®Œæ•´æ–‡æ¡£å’Œæµ‹è¯•è¯´æ˜</li></ul><p><strong>æäº¤æ–‡ä»¶</strong>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>modified:   .env.example</span></span>
<span class="line"><span>new file:   TOKEN_REFRESH_LOGOUT.md (427 lines)</span></span>
<span class="line"><span>modified:   src/modules/auth/auth.controller.ts (+57 lines)</span></span>
<span class="line"><span>modified:   src/modules/auth/auth.service.ts (+130 lines)</span></span>
<span class="line"><span>modified:   src/modules/auth/dto/index.ts</span></span>
<span class="line"><span>new file:   src/modules/auth/dto/refresh-token.dto.ts</span></span></code></pre></div><hr><h2 id="âœ…-æœ€ç»ˆç¡®è®¤" tabindex="-1">âœ… æœ€ç»ˆç¡®è®¤ <a class="header-anchor" href="#âœ…-æœ€ç»ˆç¡®è®¤" aria-label="Permalink to &quot;âœ… æœ€ç»ˆç¡®è®¤&quot;">â€‹</a></h2><p><strong>é—®é¢˜</strong>: ç™»å½•å’Œæ³¨å†Œæ¥å£æ˜¯å¦è¿”å› refreshTokenï¼Ÿ</p><p><strong>ç­”æ¡ˆ</strong>: âœ… <strong>æ˜¯çš„ï¼Œå·²ç¡®è®¤è¿”å›</strong></p><p><strong>è¯æ®</strong>:</p><ol><li>âœ… ä»£ç å®¡æŸ¥ç¡®è®¤ï¼ˆgenerateToken æ–¹æ³•è¿”å› refreshTokenï¼‰</li><li>âœ… ç™»å½•æ–¹æ³•è°ƒç”¨ generateToken å¹¶è¿”å›å®Œæ•´ token å¯¹è±¡</li><li>âœ… æ³¨å†Œæ–¹æ³•è°ƒç”¨ generateToken å¹¶è¿”å›å®Œæ•´ token å¯¹è±¡</li><li>âœ… å…¨å±€æ‹¦æˆªå™¨æ­£ç¡®åŒ…è£…å“åº”</li></ol><p><strong>çŠ¶æ€</strong>: åŠŸèƒ½å·²å®Œæ•´å®ç°ï¼Œç­‰å¾…ç½‘ç»œæ¢å¤åè¿›è¡Œå®é™…æµ‹è¯•éªŒè¯ã€‚</p><hr><p><strong>æ–‡æ¡£åˆ›å»ºæ—¶é—´</strong>: 2025-11-05 <strong>æ–‡æ¡£ç‰ˆæœ¬</strong>: v1.0 <strong>ç»´æŠ¤è€…</strong>: Backend Team</p>`,87)])])}const g=i(l,[["render",e]]);export{E as __pageData,g as default};
