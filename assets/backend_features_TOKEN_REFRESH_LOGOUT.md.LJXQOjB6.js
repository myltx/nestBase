import{_ as i,c as a,o as n,a0 as h}from"./chunks/framework.CHkYM5Ax.js";const o=JSON.parse('{"title":"Token åˆ·æ–°å’Œé€€å‡ºç™»å½•æ¥å£æ–‡æ¡£","description":"","frontmatter":{},"headers":[],"relativePath":"backend/features/TOKEN_REFRESH_LOGOUT.md","filePath":"backend/features/TOKEN_REFRESH_LOGOUT.md","lastUpdated":1762852082000}'),t={name:"backend/features/TOKEN_REFRESH_LOGOUT.md"};function l(k,s,p,e,r,E){return n(),a("div",null,[...s[0]||(s[0]=[h(`<h1 id="token-åˆ·æ–°å’Œé€€å‡ºç™»å½•æ¥å£æ–‡æ¡£" tabindex="-1">Token åˆ·æ–°å’Œé€€å‡ºç™»å½•æ¥å£æ–‡æ¡£ <a class="header-anchor" href="#token-åˆ·æ–°å’Œé€€å‡ºç™»å½•æ¥å£æ–‡æ¡£" aria-label="Permalink to &quot;Token åˆ·æ–°å’Œé€€å‡ºç™»å½•æ¥å£æ–‡æ¡£&quot;">â€‹</a></h1><h2 id="æ¦‚è¿°" tabindex="-1">æ¦‚è¿° <a class="header-anchor" href="#æ¦‚è¿°" aria-label="Permalink to &quot;æ¦‚è¿°&quot;">â€‹</a></h2><p>æœ¬æ–‡æ¡£ä»‹ç»æ–°å¢çš„ Token åˆ·æ–°å’Œé€€å‡ºç™»å½•åŠŸèƒ½ï¼Œé‡‡ç”¨åŒ Token æœºåˆ¶ï¼ˆAccess Token + Refresh Tokenï¼‰æå‡å®‰å…¨æ€§ã€‚</p><h2 id="ğŸ”-åŒ-token-æœºåˆ¶è¯´æ˜" tabindex="-1">ğŸ” åŒ Token æœºåˆ¶è¯´æ˜ <a class="header-anchor" href="#ğŸ”-åŒ-token-æœºåˆ¶è¯´æ˜" aria-label="Permalink to &quot;ğŸ” åŒ Token æœºåˆ¶è¯´æ˜&quot;">â€‹</a></h2><h3 id="token-ç±»å‹" tabindex="-1">Token ç±»å‹ <a class="header-anchor" href="#token-ç±»å‹" aria-label="Permalink to &quot;Token ç±»å‹&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>Token ç±»å‹</th><th>æœ‰æ•ˆæœŸ</th><th>ç”¨é€”</th><th>å­˜å‚¨ä½ç½®å»ºè®®</th></tr></thead><tbody><tr><td><strong>Access Token</strong></td><td>çŸ­æœŸï¼ˆé»˜è®¤ 15 åˆ†é’Ÿï¼‰</td><td>API è®¿é—®è®¤è¯</td><td>å†…å­˜ï¼ˆä¸å»ºè®® localStorageï¼‰</td></tr><tr><td><strong>Refresh Token</strong></td><td>é•¿æœŸï¼ˆé»˜è®¤ 7 å¤©ï¼‰</td><td>åˆ·æ–° Access Token</td><td>HttpOnly Cookie æˆ–å®‰å…¨å­˜å‚¨</td></tr></tbody></table><h3 id="å·¥ä½œæµç¨‹" tabindex="-1">å·¥ä½œæµç¨‹ <a class="header-anchor" href="#å·¥ä½œæµç¨‹" aria-label="Permalink to &quot;å·¥ä½œæµç¨‹&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. ç”¨æˆ·ç™»å½• â†’ è·å¾— accessToken + refreshToken</span></span>
<span class="line"><span>2. ä½¿ç”¨ accessToken è®¿é—® API</span></span>
<span class="line"><span>3. accessToken è¿‡æœŸ â†’ ä½¿ç”¨ refreshToken è·å–æ–°çš„ Token å¯¹</span></span>
<span class="line"><span>4. ç»§ç»­ä½¿ç”¨æ–°çš„ accessToken è®¿é—® API</span></span>
<span class="line"><span>5. ç”¨æˆ·é€€å‡º â†’ å®¢æˆ·ç«¯åˆ é™¤æ‰€æœ‰ Token</span></span></code></pre></div><hr><h2 id="ğŸ“¡-api-æ¥å£" tabindex="-1">ğŸ“¡ API æ¥å£ <a class="header-anchor" href="#ğŸ“¡-api-æ¥å£" aria-label="Permalink to &quot;ğŸ“¡ API æ¥å£&quot;">â€‹</a></h2><h3 id="_1-ç”¨æˆ·ç™»å½•-å·²æ›´æ–°" tabindex="-1">1. ç”¨æˆ·ç™»å½•ï¼ˆå·²æ›´æ–°ï¼‰ <a class="header-anchor" href="#_1-ç”¨æˆ·ç™»å½•-å·²æ›´æ–°" aria-label="Permalink to &quot;1. ç”¨æˆ·ç™»å½•ï¼ˆå·²æ›´æ–°ï¼‰&quot;">â€‹</a></h3><p><strong>æ¥å£</strong>: <code>POST /api/auth/login</code></p><p><strong>æƒé™</strong>: å…¬å¼€æ¥å£</p><p><strong>è¯·æ±‚ä½“</strong>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;userName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;admin@example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;password&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;admin123&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>å“åº”ç¤ºä¾‹</strong>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user-uuid&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;email&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;admin@example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;userName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;admin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;nickName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ç®¡ç†å‘˜&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;roles&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ADMIN&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MODERATOR&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;accessToken&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;refreshToken&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;expiresIn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;15m&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>å˜åŒ–è¯´æ˜</strong>:</p><ul><li>âœ… æ–°å¢ <code>refreshToken</code> å­—æ®µ</li><li>âœ… <code>expiresIn</code> ç°åœ¨è¡¨ç¤º Access Token çš„æœ‰æ•ˆæœŸ</li></ul><hr><h3 id="_2-åˆ·æ–°-access-token-æ–°å¢" tabindex="-1">2. åˆ·æ–° Access Tokenï¼ˆæ–°å¢ï¼‰ <a class="header-anchor" href="#_2-åˆ·æ–°-access-token-æ–°å¢" aria-label="Permalink to &quot;2. åˆ·æ–° Access Tokenï¼ˆæ–°å¢ï¼‰&quot;">â€‹</a></h3><p><strong>æ¥å£</strong>: <code>POST /api/auth/refresh</code></p><p><strong>æƒé™</strong>: å…¬å¼€æ¥å£ï¼ˆæ— éœ€ Access Tokenï¼‰</p><p><strong>è¯·æ±‚ä½“</strong>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;refreshToken&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>å“åº”ç¤ºä¾‹ï¼ˆæˆåŠŸï¼‰</strong>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user-uuid&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;email&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;admin@example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;userName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;admin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;nickName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ç®¡ç†å‘˜&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;roles&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ADMIN&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MODERATOR&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;accessToken&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ–°çš„ Access Token</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;refreshToken&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ–°çš„ Refresh Token</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;expiresIn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;15m&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>å“åº”ç¤ºä¾‹ï¼ˆå¤±è´¥ï¼‰</strong>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Refresh Token å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;code&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1107</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;statusCode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">401</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;timestamp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2025-11-05T15:30:00.000Z&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>é”™è¯¯ç è¯´æ˜</strong>:</p><ul><li><code>1107</code> - Token å·²è¿‡æœŸ</li><li><code>1108</code> - Token æ— æ•ˆ</li><li><code>1104</code> - ç”¨æˆ·ä¸å­˜åœ¨</li><li><code>1105</code> - è´¦æˆ·å·²è¢«ç¦ç”¨</li></ul><p><strong>ä½¿ç”¨åœºæ™¯</strong>:</p><ul><li>Access Token å³å°†è¿‡æœŸæˆ–å·²è¿‡æœŸæ—¶</li><li>åº”ç”¨å¯åŠ¨æ—¶æ£€æŸ¥ Token æ˜¯å¦ä»ç„¶æœ‰æ•ˆ</li><li>é™é»˜åˆ·æ–°ï¼ˆåœ¨åå°è‡ªåŠ¨åˆ·æ–°ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥ï¼‰</li></ul><hr><h3 id="_3-é€€å‡ºç™»å½•-æ–°å¢" tabindex="-1">3. é€€å‡ºç™»å½•ï¼ˆæ–°å¢ï¼‰ <a class="header-anchor" href="#_3-é€€å‡ºç™»å½•-æ–°å¢" aria-label="Permalink to &quot;3. é€€å‡ºç™»å½•ï¼ˆæ–°å¢ï¼‰&quot;">â€‹</a></h3><p><strong>æ¥å£</strong>: <code>POST /api/auth/logout</code></p><p><strong>æƒé™</strong>: éœ€è¦è®¤è¯ï¼ˆæºå¸¦ Access Tokenï¼‰</p><p><strong>è¯·æ±‚å¤´</strong>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Authorization: Bearer &lt;accessToken&gt;</span></span></code></pre></div><p><strong>è¯·æ±‚ä½“</strong>: æ— </p><p><strong>å“åº”ç¤ºä¾‹</strong>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;é€€å‡ºç™»å½•æˆåŠŸ&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>å®¢æˆ·ç«¯æ“ä½œ</strong>:</p><ol><li>è°ƒç”¨é€€å‡ºç™»å½•æ¥å£</li><li>åˆ é™¤æœ¬åœ°å­˜å‚¨çš„ accessToken å’Œ refreshToken</li><li>æ¸…é™¤ç”¨æˆ·ä¿¡æ¯</li><li>è·³è½¬åˆ°ç™»å½•é¡µ</li></ol><p><strong>æ³¨æ„äº‹é¡¹</strong>:</p><ul><li>ç”±äº JWT æ˜¯æ— çŠ¶æ€çš„ï¼Œé€€å‡ºç™»å½•ä¸»è¦ä¾èµ–å®¢æˆ·ç«¯åˆ é™¤ Token</li><li>å¦‚éœ€å®ç° Token é»‘åå•ï¼ˆçœŸæ­£çš„æœåŠ¡ç«¯å¤±æ•ˆï¼‰ï¼Œéœ€è¦å¼•å…¥ Redis</li></ul><hr><h2 id="ğŸ”§-ç¯å¢ƒå˜é‡é…ç½®" tabindex="-1">ğŸ”§ ç¯å¢ƒå˜é‡é…ç½® <a class="header-anchor" href="#ğŸ”§-ç¯å¢ƒå˜é‡é…ç½®" aria-label="Permalink to &quot;ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®&quot;">â€‹</a></h2><p>åœ¨ <code>.env</code> æ–‡ä»¶ä¸­é…ç½®ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># JWT å¯†é’¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">JWT_SECRET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your-super-secret-jwt-key-change-this-in-production</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Access Token æœ‰æ•ˆæœŸï¼ˆçŸ­æœŸï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">JWT_ACCESS_EXPIRES_IN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">15m</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Refresh Token æœ‰æ•ˆæœŸï¼ˆé•¿æœŸï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">JWT_REFRESH_EXPIRES_IN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">7d</span></span></code></pre></div><p><strong>æ¨èé…ç½®</strong>:</p><ul><li><strong>å¼€å‘ç¯å¢ƒ</strong>: Access Token = 1h, Refresh Token = 7d</li><li><strong>ç”Ÿäº§ç¯å¢ƒ</strong>: Access Token = 15m, Refresh Token = 7d</li><li><strong>é«˜å®‰å…¨ç¯å¢ƒ</strong>: Access Token = 5m, Refresh Token = 1d</li></ul><hr><h2 id="ğŸ’»-å®¢æˆ·ç«¯é›†æˆç¤ºä¾‹" tabindex="-1">ğŸ’» å®¢æˆ·ç«¯é›†æˆç¤ºä¾‹ <a class="header-anchor" href="#ğŸ’»-å®¢æˆ·ç«¯é›†æˆç¤ºä¾‹" aria-label="Permalink to &quot;ğŸ’» å®¢æˆ·ç«¯é›†æˆç¤ºä¾‹&quot;">â€‹</a></h2><h3 id="_1-axios-æ‹¦æˆªå™¨å®ç°è‡ªåŠ¨åˆ·æ–°" tabindex="-1">1. Axios æ‹¦æˆªå™¨å®ç°è‡ªåŠ¨åˆ·æ–° <a class="header-anchor" href="#_1-axios-æ‹¦æˆªå™¨å®ç°è‡ªåŠ¨åˆ·æ–°" aria-label="Permalink to &quot;1. Axios æ‹¦æˆªå™¨å®ç°è‡ªåŠ¨åˆ·æ–°&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> axios </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;axios&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> api</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> axios.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  baseURL: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://localhost:3000/api&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¯·æ±‚æ‹¦æˆªå™¨ï¼šè‡ªåŠ¨æ·»åŠ  Access Token</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">api.interceptors.request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> accessToken</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;accessToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (accessToken) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      config.headers.Authorization </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`Bearer \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">accessToken</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> config;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(error)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å“åº”æ‹¦æˆªå™¨ï¼šè‡ªåŠ¨åˆ·æ–° Token</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">api.interceptors.response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> originalRequest</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error.config;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å¦‚æœæ˜¯ 401 é”™è¯¯ä¸”æœªé‡è¯•è¿‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error.response?.status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 401</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">originalRequest._retry) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      originalRequest._retry </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ä½¿ç”¨ Refresh Token è·å–æ–°çš„ Token</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> refreshToken</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;refreshToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> axios.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          &#39;http://localhost:3000/api/auth/refresh&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          { refreshToken }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ä¿å­˜æ–°çš„ Token</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;accessToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, data.data.token.accessToken);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;refreshToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, data.data.token.refreshToken);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // é‡è¯•åŸè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        originalRequest.headers.Authorization </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`Bearer \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">token</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">accessToken</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> api</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(originalRequest);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (refreshError) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Refresh Token ä¹Ÿå¤±æ•ˆäº†ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clear</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        window.location.href </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(refreshError);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(error);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> api;</span></span></code></pre></div><h3 id="_2-ç™»å½•å¤„ç†" tabindex="-1">2. ç™»å½•å¤„ç† <a class="header-anchor" href="#_2-ç™»å½•å¤„ç†" aria-label="Permalink to &quot;2. ç™»å½•å¤„ç†&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> login</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userName</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">password</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> api.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/auth/login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { userName, password });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ä¿å­˜ Token</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;accessToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, data.data.token.accessToken);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;refreshToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, data.data.token.refreshToken);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ä¿å­˜ç”¨æˆ·ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;user&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data.data.user));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ç™»å½•å¤±è´¥:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_3-é€€å‡ºç™»å½•å¤„ç†" tabindex="-1">3. é€€å‡ºç™»å½•å¤„ç† <a class="header-anchor" href="#_3-é€€å‡ºç™»å½•å¤„ç†" aria-label="Permalink to &quot;3. é€€å‡ºç™»å½•å¤„ç†&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> logout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è°ƒç”¨é€€å‡ºæ¥å£</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> api.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/auth/logout&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;é€€å‡ºç™»å½•å¤±è´¥:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">finally</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ— è®ºæˆåŠŸå¤±è´¥ï¼Œéƒ½æ¸…é™¤æœ¬åœ°æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">removeItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;accessToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">removeItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;refreshToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">removeItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;user&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è·³è½¬åˆ°ç™»å½•é¡µ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    window.location.href </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_4-åº”ç”¨å¯åŠ¨æ—¶éªŒè¯-token" tabindex="-1">4. åº”ç”¨å¯åŠ¨æ—¶éªŒè¯ Token <a class="header-anchor" href="#_4-åº”ç”¨å¯åŠ¨æ—¶éªŒè¯-token" aria-label="Permalink to &quot;4. åº”ç”¨å¯åŠ¨æ—¶éªŒè¯ Token&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> initializeApp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> refreshToken</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;refreshToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">refreshToken) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ²¡æœ‰ Refresh Tokenï¼Œè·³è½¬åˆ°ç™»å½•é¡µ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    window.location.href </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å°è¯•åˆ·æ–° Token</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> axios.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;http://localhost:3000/api/auth/refresh&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      { refreshToken }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ä¿å­˜æ–°çš„ Token</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;accessToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, data.data.token.accessToken);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;refreshToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, data.data.token.refreshToken);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;user&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data.data.user));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ç»§ç»­åŠ è½½åº”ç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Token å¤±æ•ˆï¼Œæ¸…é™¤æ•°æ®å¹¶è·³è½¬ç™»å½•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clear</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    window.location.href </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="ğŸ”’-å®‰å…¨æœ€ä½³å®è·µ" tabindex="-1">ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ <a class="header-anchor" href="#ğŸ”’-å®‰å…¨æœ€ä½³å®è·µ" aria-label="Permalink to &quot;ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ&quot;">â€‹</a></h2><h3 id="_1-token-å­˜å‚¨" tabindex="-1">1. Token å­˜å‚¨ <a class="header-anchor" href="#_1-token-å­˜å‚¨" aria-label="Permalink to &quot;1. Token å­˜å‚¨&quot;">â€‹</a></h3><p><strong>æ¨èæ–¹æ¡ˆ</strong>:</p><ul><li>âœ… <strong>Access Token</strong>: å­˜å‚¨åœ¨å†…å­˜ï¼ˆç»„ä»¶çŠ¶æ€/Vuex/Reduxï¼‰</li><li>âœ… <strong>Refresh Token</strong>: å­˜å‚¨åœ¨ HttpOnly Cookieï¼ˆæœ€å®‰å…¨ï¼‰</li></ul><p><strong>ä¸æ¨è</strong>:</p><ul><li>âŒ å°† Access Token å­˜å‚¨åœ¨ localStorageï¼ˆæ˜“å— XSS æ”»å‡»ï¼‰</li><li>âŒ å°† Refresh Token æš´éœ²ç»™ JavaScriptï¼ˆåº”ç”±æœåŠ¡å™¨è‡ªåŠ¨å¤„ç†ï¼‰</li></ul><h3 id="_2-https" tabindex="-1">2. HTTPS <a class="header-anchor" href="#_2-https" aria-label="Permalink to &quot;2. HTTPS&quot;">â€‹</a></h3><p><strong>ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ HTTPS</strong>ï¼Œé˜²æ­¢ Token åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«çªƒå–ã€‚</p><h3 id="_3-token-è½®æ¢" tabindex="-1">3. Token è½®æ¢ <a class="header-anchor" href="#_3-token-è½®æ¢" aria-label="Permalink to &quot;3. Token è½®æ¢&quot;">â€‹</a></h3><p>æ¯æ¬¡åˆ·æ–° Token æ—¶ï¼Œè¿”å›æ–°çš„ Refresh Tokenï¼ˆå·²å®ç°ï¼‰ï¼Œé˜²æ­¢ Token é‡æ”¾æ”»å‡»ã€‚</p><h3 id="_4-refresh-token-é™åˆ¶" tabindex="-1">4. Refresh Token é™åˆ¶ <a class="header-anchor" href="#_4-refresh-token-é™åˆ¶" aria-label="Permalink to &quot;4. Refresh Token é™åˆ¶&quot;">â€‹</a></h3><ul><li>å•ç”¨æˆ·å•è®¾å¤‡ï¼šæ¯æ¬¡ç™»å½•ä½¿æ—§çš„ Refresh Token å¤±æ•ˆ</li><li>å¤šè®¾å¤‡æ”¯æŒï¼šåœ¨æ•°æ®åº“ä¸­è®°å½•æ´»è·ƒçš„ Refresh Token</li><li>Token é»‘åå•ï¼šå°†å·²é€€å‡ºçš„ Token åŠ å…¥é»‘åå•ï¼ˆéœ€è¦ Redisï¼‰</li></ul><h3 id="_5-ç”¨æˆ·çŠ¶æ€æ£€æŸ¥" tabindex="-1">5. ç”¨æˆ·çŠ¶æ€æ£€æŸ¥ <a class="header-anchor" href="#_5-ç”¨æˆ·çŠ¶æ€æ£€æŸ¥" aria-label="Permalink to &quot;5. ç”¨æˆ·çŠ¶æ€æ£€æŸ¥&quot;">â€‹</a></h3><p>åˆ·æ–° Token æ—¶ä¼šæ£€æŸ¥ç”¨æˆ·çŠ¶æ€ï¼Œå¦‚æœç”¨æˆ·è¢«ç¦ç”¨ï¼Œå°†æ‹’ç»åˆ·æ–°ã€‚</p><hr><h2 id="ğŸš€-æµ‹è¯•ç¤ºä¾‹" tabindex="-1">ğŸš€ æµ‹è¯•ç¤ºä¾‹ <a class="header-anchor" href="#ğŸš€-æµ‹è¯•ç¤ºä¾‹" aria-label="Permalink to &quot;ğŸš€ æµ‹è¯•ç¤ºä¾‹&quot;">â€‹</a></h2><h3 id="ä½¿ç”¨-curl-æµ‹è¯•" tabindex="-1">ä½¿ç”¨ cURL æµ‹è¯• <a class="header-anchor" href="#ä½¿ç”¨-curl-æµ‹è¯•" aria-label="Permalink to &quot;ä½¿ç”¨ cURL æµ‹è¯•&quot;">â€‹</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. ç™»å½•è·å– Token</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:3000/api/auth/login</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Content-Type: application/json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;userName&quot;:&quot;admin@example.com&quot;,&quot;password&quot;:&quot;admin123&quot;}&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä¿å­˜è¿”å›çš„ accessToken å’Œ refreshToken</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. ä½¿ç”¨ Access Token è®¿é—® API</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:3000/api/auth/profile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer YOUR_ACCESS_TOKEN&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. åˆ·æ–° Token</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:3000/api/auth/refresh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Content-Type: application/json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;refreshToken&quot;:&quot;YOUR_REFRESH_TOKEN&quot;}&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. é€€å‡ºç™»å½•</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:3000/api/auth/logout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer YOUR_ACCESS_TOKEN&quot;</span></span></code></pre></div><hr><h2 id="ğŸ“-å¸¸è§é—®é¢˜" tabindex="-1">ğŸ“ å¸¸è§é—®é¢˜ <a class="header-anchor" href="#ğŸ“-å¸¸è§é—®é¢˜" aria-label="Permalink to &quot;ğŸ“ å¸¸è§é—®é¢˜&quot;">â€‹</a></h2><h3 id="q1-access-token-è¿‡æœŸäº†æ€ä¹ˆåŠ" tabindex="-1">Q1: Access Token è¿‡æœŸäº†æ€ä¹ˆåŠï¼Ÿ <a class="header-anchor" href="#q1-access-token-è¿‡æœŸäº†æ€ä¹ˆåŠ" aria-label="Permalink to &quot;Q1: Access Token è¿‡æœŸäº†æ€ä¹ˆåŠï¼Ÿ&quot;">â€‹</a></h3><p>A: ä½¿ç”¨ Refresh Token è°ƒç”¨ <code>/api/auth/refresh</code> æ¥å£è·å–æ–°çš„ Token å¯¹ã€‚å»ºè®®åœ¨å®¢æˆ·ç«¯å®ç°è‡ªåŠ¨åˆ·æ–°æœºåˆ¶ï¼ˆè§ä¸Šé¢çš„ Axios æ‹¦æˆªå™¨ç¤ºä¾‹ï¼‰ã€‚</p><h3 id="q2-refresh-token-ä¹Ÿè¿‡æœŸäº†æ€ä¹ˆåŠ" tabindex="-1">Q2: Refresh Token ä¹Ÿè¿‡æœŸäº†æ€ä¹ˆåŠï¼Ÿ <a class="header-anchor" href="#q2-refresh-token-ä¹Ÿè¿‡æœŸäº†æ€ä¹ˆåŠ" aria-label="Permalink to &quot;Q2: Refresh Token ä¹Ÿè¿‡æœŸäº†æ€ä¹ˆåŠï¼Ÿ&quot;">â€‹</a></h3><p>A: éœ€è¦ç”¨æˆ·é‡æ–°ç™»å½•ã€‚Refresh Token è¿‡æœŸé€šå¸¸æ„å‘³ç€ç”¨æˆ·é•¿æ—¶é—´æœªä½¿ç”¨åº”ç”¨ã€‚</p><h3 id="q3-å¦‚ä½•å®ç°-è®°ä½æˆ‘-åŠŸèƒ½" tabindex="-1">Q3: å¦‚ä½•å®ç°&quot;è®°ä½æˆ‘&quot;åŠŸèƒ½ï¼Ÿ <a class="header-anchor" href="#q3-å¦‚ä½•å®ç°-è®°ä½æˆ‘-åŠŸèƒ½" aria-label="Permalink to &quot;Q3: å¦‚ä½•å®ç°&quot;è®°ä½æˆ‘&quot;åŠŸèƒ½ï¼Ÿ&quot;">â€‹</a></h3><p>A: å»¶é•¿ Refresh Token çš„æœ‰æ•ˆæœŸï¼ˆå¦‚ 30 å¤©ï¼‰ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯æŒä¹…åŒ–å­˜å‚¨ã€‚</p><h3 id="q4-å¦‚ä½•å¼ºåˆ¶ç”¨æˆ·ä¸‹çº¿" tabindex="-1">Q4: å¦‚ä½•å¼ºåˆ¶ç”¨æˆ·ä¸‹çº¿ï¼Ÿ <a class="header-anchor" href="#q4-å¦‚ä½•å¼ºåˆ¶ç”¨æˆ·ä¸‹çº¿" aria-label="Permalink to &quot;Q4: å¦‚ä½•å¼ºåˆ¶ç”¨æˆ·ä¸‹çº¿ï¼Ÿ&quot;">â€‹</a></h3><p>A: å½“å‰å®ç°ä¸ºæ— çŠ¶æ€ JWTï¼Œæ— æ³•å¼ºåˆ¶ä¸‹çº¿ã€‚å¦‚éœ€æ­¤åŠŸèƒ½ï¼Œéœ€è¦ï¼š</p><ol><li>å®ç° Token é»‘åå•ï¼ˆä½¿ç”¨ Redisï¼‰</li><li>æˆ–è€…ä½¿ç”¨æ•°æ®åº“è®°å½•æ´»è·ƒçš„ Refresh Token</li></ol><h3 id="q5-å¤šè®¾å¤‡ç™»å½•å¦‚ä½•å¤„ç†" tabindex="-1">Q5: å¤šè®¾å¤‡ç™»å½•å¦‚ä½•å¤„ç†ï¼Ÿ <a class="header-anchor" href="#q5-å¤šè®¾å¤‡ç™»å½•å¦‚ä½•å¤„ç†" aria-label="Permalink to &quot;Q5: å¤šè®¾å¤‡ç™»å½•å¦‚ä½•å¤„ç†ï¼Ÿ&quot;">â€‹</a></h3><p>A: å½“å‰å®ç°æ”¯æŒå¤šè®¾å¤‡ç™»å½•ã€‚å¦‚éœ€é™åˆ¶ï¼Œå¯ä»¥ï¼š</p><ol><li>åœ¨æ•°æ®åº“ä¸­åªä¿ç•™æœ€æ–°çš„ Refresh Token</li><li>ç™»å½•æ—¶ä½¿æ—§çš„ Token å¤±æ•ˆ</li></ol><hr><h2 id="ğŸ¯-åç»­ä¼˜åŒ–å»ºè®®" tabindex="-1">ğŸ¯ åç»­ä¼˜åŒ–å»ºè®® <a class="header-anchor" href="#ğŸ¯-åç»­ä¼˜åŒ–å»ºè®®" aria-label="Permalink to &quot;ğŸ¯ åç»­ä¼˜åŒ–å»ºè®®&quot;">â€‹</a></h2><ol><li><strong>Token é»‘åå•</strong>: ä½¿ç”¨ Redis å®ç°çœŸæ­£çš„ Token å¤±æ•ˆ</li><li><strong>è®¾å¤‡ç®¡ç†</strong>: è®°å½•ç”¨æˆ·çš„ç™»å½•è®¾å¤‡ï¼Œæ”¯æŒè¿œç¨‹ä¸‹çº¿</li><li><strong>å®¡è®¡æ—¥å¿—</strong>: è®°å½•æ‰€æœ‰ç™»å½•ã€åˆ·æ–°ã€é€€å‡ºæ“ä½œï¼ˆå¯é›†æˆç°æœ‰çš„ AuditModuleï¼‰</li><li><strong>IP é™åˆ¶</strong>: é™åˆ¶ Token åªèƒ½åœ¨å›ºå®š IP ä½¿ç”¨</li><li><strong>æŒ‡çº¹éªŒè¯</strong>: æ£€æµ‹å®¢æˆ·ç«¯æŒ‡çº¹ï¼Œé˜²æ­¢ Token è¢«ç›—ç”¨</li><li><strong>æ»‘åŠ¨è¿‡æœŸ</strong>: Access Token æ¯æ¬¡ä½¿ç”¨åè‡ªåŠ¨å»¶é•¿æœ‰æ•ˆæœŸ</li></ol><hr><p><strong>æœ€åæ›´æ–°</strong>: 2025-11-05 <strong>ç‰ˆæœ¬</strong>: v1.6.0</p>`,100)])])}const g=i(t,[["render",l]]);export{o as __pageData,g as default};
