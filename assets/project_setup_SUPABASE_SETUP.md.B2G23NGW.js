import{_ as a,c as e,o as i,a0 as t}from"./chunks/framework.CHkYM5Ax.js";const g=JSON.parse('{"title":"Supabase é…ç½®æŒ‡å—","description":"","frontmatter":{},"headers":[],"relativePath":"project/setup/SUPABASE_SETUP.md","filePath":"project/setup/SUPABASE_SETUP.md","lastUpdated":1762852082000}'),n={name:"project/setup/SUPABASE_SETUP.md"};function l(o,s,p,r,d,h){return i(),e("div",null,[...s[0]||(s[0]=[t(`<h1 id="supabase-é…ç½®æŒ‡å—" tabindex="-1">Supabase é…ç½®æŒ‡å— <a class="header-anchor" href="#supabase-é…ç½®æŒ‡å—" aria-label="Permalink to &quot;Supabase é…ç½®æŒ‡å—&quot;">â€‹</a></h1><p>æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•é…ç½® Supabase æ•°æ®åº“è¿æ¥ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹ <strong>IPv4 ç½‘ç»œ</strong>çš„é…ç½®æ–¹æ³•ã€‚</p><hr><h2 id="ğŸ“‹-é…ç½®æ­¥éª¤" tabindex="-1">ğŸ“‹ é…ç½®æ­¥éª¤ <a class="header-anchor" href="#ğŸ“‹-é…ç½®æ­¥éª¤" aria-label="Permalink to &quot;ğŸ“‹ é…ç½®æ­¥éª¤&quot;">â€‹</a></h2><h3 id="_1-åˆ›å»º-supabase-é¡¹ç›®" tabindex="-1">1. åˆ›å»º Supabase é¡¹ç›® <a class="header-anchor" href="#_1-åˆ›å»º-supabase-é¡¹ç›®" aria-label="Permalink to &quot;1. åˆ›å»º Supabase é¡¹ç›®&quot;">â€‹</a></h3><ol><li><p>è®¿é—® <a href="https://supabase.com/dashboard" target="_blank" rel="noreferrer">Supabase æ§åˆ¶å°</a></p></li><li><p>ç‚¹å‡» <strong>New Project</strong></p></li><li><p>å¡«å†™é¡¹ç›®ä¿¡æ¯ï¼š</p><ul><li>Organizationï¼ˆç»„ç»‡ï¼‰</li><li>Project Nameï¼ˆé¡¹ç›®åç§°ï¼‰</li><li>Database Passwordï¼ˆæ•°æ®åº“å¯†ç ï¼Œè¯·å¦¥å–„ä¿ç®¡ï¼‰</li><li>Regionï¼ˆåŒºåŸŸï¼Œå»ºè®®é€‰æ‹©ç¦»ä½ æœ€è¿‘çš„ï¼‰</li></ul></li><li><p>ç‚¹å‡» <strong>Create new project</strong>ï¼Œç­‰å¾…é¡¹ç›®åˆå§‹åŒ–ï¼ˆçº¦ 2 åˆ†é’Ÿï¼‰</p></li></ol><hr><h3 id="_2-è·å–æ•°æ®åº“è¿æ¥ä¿¡æ¯" tabindex="-1">2. è·å–æ•°æ®åº“è¿æ¥ä¿¡æ¯ <a class="header-anchor" href="#_2-è·å–æ•°æ®åº“è¿æ¥ä¿¡æ¯" aria-label="Permalink to &quot;2. è·å–æ•°æ®åº“è¿æ¥ä¿¡æ¯&quot;">â€‹</a></h3><h4 id="æ­¥éª¤-a-æ£€æŸ¥-ipv4-å…¼å®¹æ€§" tabindex="-1">æ­¥éª¤ Aï¼šæ£€æŸ¥ IPv4 å…¼å®¹æ€§ <a class="header-anchor" href="#æ­¥éª¤-a-æ£€æŸ¥-ipv4-å…¼å®¹æ€§" aria-label="Permalink to &quot;æ­¥éª¤ Aï¼šæ£€æŸ¥ IPv4 å…¼å®¹æ€§&quot;">â€‹</a></h4><ol><li>è¿›å…¥é¡¹ç›®åï¼Œç‚¹å‡»å·¦ä¾§èœå• <strong>Settings</strong>ï¼ˆè®¾ç½®å›¾æ ‡ï¼‰</li><li>é€‰æ‹© <strong>Database</strong></li><li>æ»šåŠ¨åˆ° <strong>Connection string</strong> éƒ¨åˆ†</li><li>æŸ¥çœ‹æ˜¯å¦æœ‰ <strong>&quot;Not IPv4 compatible&quot;</strong> æç¤º</li></ol><h4 id="æ­¥éª¤-b-è·å–è¿æ¥å­—ç¬¦ä¸²" tabindex="-1">æ­¥éª¤ Bï¼šè·å–è¿æ¥å­—ç¬¦ä¸² <a class="header-anchor" href="#æ­¥éª¤-b-è·å–è¿æ¥å­—ç¬¦ä¸²" aria-label="Permalink to &quot;æ­¥éª¤ Bï¼šè·å–è¿æ¥å­—ç¬¦ä¸²&quot;">â€‹</a></h4><p><strong>å¦‚æœæ˜¾ç¤º &quot;Not IPv4 compatible&quot;ï¼ˆå¤§å¤šæ•°æƒ…å†µï¼‰ï¼š</strong></p><ol><li><p>å‹¾é€‰ âœ… <strong>Use connection pooling</strong></p></li><li><p>é€‰æ‹©è¿æ¥æ¨¡å¼ï¼š</p><ul><li><strong>Transaction mode</strong>ï¼ˆæ¨èï¼‰- ç”¨äºåº”ç”¨è¿è¡Œæ—¶</li><li><strong>Session mode</strong> - ç”¨äºæ•°æ®åº“è¿ç§»</li></ul></li><li><p>é€‰æ‹© <strong>URI</strong> æ ‡ç­¾é¡µ</p></li><li><p>å¤åˆ¶è¿æ¥å­—ç¬¦ä¸²ï¼Œæ ¼å¼ç±»ä¼¼ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>postgresql://postgres.xxxxx:[YOUR-PASSWORD]@aws-x-region.pooler.supabase.com:6543/postgres</span></span></code></pre></div></li></ol><p><strong>å¦‚æœ IPv6 å¯ç”¨ï¼ˆå°‘æ•°æƒ…å†µï¼‰ï¼š</strong></p><p>å¯ä»¥ç›´æ¥ä½¿ç”¨ Direct connectionï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>postgresql://postgres.xxxxx:[YOUR-PASSWORD]@db.xxxxx.supabase.co:5432/postgres</span></span></code></pre></div><hr><h3 id="_3-è·å–-api-å¯†é’¥" tabindex="-1">3. è·å– API å¯†é’¥ <a class="header-anchor" href="#_3-è·å–-api-å¯†é’¥" aria-label="Permalink to &quot;3. è·å– API å¯†é’¥&quot;">â€‹</a></h3><ol><li>åœ¨ <strong>Settings</strong> ä¸­é€‰æ‹© <strong>API</strong></li><li>å¤åˆ¶ä»¥ä¸‹ä¿¡æ¯ï¼š <ul><li><strong>Project URL</strong>ï¼ˆé¡¹ç›® URLï¼‰</li><li><strong>anon public</strong>ï¼ˆåŒ¿åå…¬é’¥ï¼‰</li><li><strong>service_role</strong>ï¼ˆæœåŠ¡è§’è‰²å¯†é’¥ï¼Œç‚¹å‡»çœ¼ç›å›¾æ ‡æ˜¾ç¤ºï¼‰</li></ul></li></ol><hr><h3 id="_4-é…ç½®ç¯å¢ƒå˜é‡" tabindex="-1">4. é…ç½®ç¯å¢ƒå˜é‡ <a class="header-anchor" href="#_4-é…ç½®ç¯å¢ƒå˜é‡" aria-label="Permalink to &quot;4. é…ç½®ç¯å¢ƒå˜é‡&quot;">â€‹</a></h3><p>ç¼–è¾‘ <code>apps/backend/.env</code> æ–‡ä»¶ï¼š</p><div class="language-env vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">env</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># Supabase API é…ç½®</span></span>
<span class="line"><span>SUPABASE_URL=https://xxxxx.supabase.co</span></span>
<span class="line"><span>SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...</span></span>
<span class="line"><span>SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æ•°æ®åº“è¿æ¥ - IPv4 ç½‘ç»œä½¿ç”¨ Session Pooler</span></span>
<span class="line"><span># Transaction mode (ç«¯å£ 6543) - åº”ç”¨è¿è¡Œæ—¶ä½¿ç”¨</span></span>
<span class="line"><span>DATABASE_URL=&quot;postgresql://postgres.xxxxx:YourPassword123@aws-x-region.pooler.supabase.com:6543/postgres?pgbouncer=true&amp;connection_limit=1&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Session mode (ç«¯å£ 5432) - æ•°æ®åº“è¿ç§»ä½¿ç”¨</span></span>
<span class="line"><span>DIRECT_URL=&quot;postgresql://postgres.xxxxx:YourPassword123@aws-x-region.pooler.supabase.com:5432/postgres&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># JWT é…ç½®</span></span>
<span class="line"><span>JWT_SECRET=your-super-secret-jwt-key</span></span>
<span class="line"><span>JWT_EXPIRES_IN=7d</span></span></code></pre></div><hr><h2 id="âš ï¸-é‡è¦æ³¨æ„äº‹é¡¹" tabindex="-1">âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹ <a class="header-anchor" href="#âš ï¸-é‡è¦æ³¨æ„äº‹é¡¹" aria-label="Permalink to &quot;âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹&quot;">â€‹</a></h2><h3 id="å¯†ç -url-ç¼–ç " tabindex="-1">å¯†ç  URL ç¼–ç  <a class="header-anchor" href="#å¯†ç -url-ç¼–ç " aria-label="Permalink to &quot;å¯†ç  URL ç¼–ç &quot;">â€‹</a></h3><p>å¦‚æœä½ çš„æ•°æ®åº“å¯†ç åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œ<strong>å¿…é¡»</strong>è¿›è¡Œ URL ç¼–ç ï¼š</p><table tabindex="0"><thead><tr><th>åŸå­—ç¬¦</th><th>ç¼–ç å</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>@</code></td><td><code>%40</code></td><td><code>my@pass</code> â†’ <code>my%40pass</code></td></tr><tr><td><code>#</code></td><td><code>%23</code></td><td><code>pass#123</code> â†’ <code>pass%23123</code></td></tr><tr><td><code>$</code></td><td><code>%24</code></td><td><code>$ecure</code> â†’ <code>%24ecure</code></td></tr><tr><td><code>%</code></td><td><code>%25</code></td><td><code>50%</code> â†’ <code>50%25</code></td></tr><tr><td><code>&amp;</code></td><td><code>%26</code></td><td><code>me&amp;you</code> â†’ <code>me%26you</code></td></tr><tr><td><code>+</code></td><td><code>%2B</code></td><td><code>a+b</code> â†’ <code>a%2Bb</code></td></tr><tr><td><code>/</code></td><td><code>%2F</code></td><td><code>a/b</code> â†’ <code>a%2Fb</code></td></tr><tr><td><code>:</code></td><td><code>%3A</code></td><td><code>a:b</code> â†’ <code>a%3Ab</code></td></tr><tr><td><code>=</code></td><td><code>%3D</code></td><td><code>a=b</code> â†’ <code>a%3Db</code></td></tr><tr><td><code>?</code></td><td><code>%3F</code></td><td><code>a?b</code> â†’ <code>a%3Fb</code></td></tr><tr><td><code></code>ï¼ˆç©ºæ ¼ï¼‰</td><td><code>%20</code></td><td><code>my pass</code> â†’ <code>my%20pass</code></td></tr></tbody></table><p><strong>ç¤ºä¾‹</strong>ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>åŸå¯†ç ï¼šll940223..@@</span></span>
<span class="line"><span>ç¼–ç åï¼šll940223..%40%40</span></span>
<span class="line"><span></span></span>
<span class="line"><span>åŸå¯†ç ï¼šMyP@ss#2024!</span></span>
<span class="line"><span>ç¼–ç åï¼šMyP%40ss%232024!</span></span></code></pre></div><h3 id="database-url-vs-direct-url" tabindex="-1">DATABASE_URL vs DIRECT_URL <a class="header-anchor" href="#database-url-vs-direct-url" aria-label="Permalink to &quot;DATABASE_URL vs DIRECT_URL&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>é…ç½®é¡¹</th><th>ç”¨é€”</th><th>ç«¯å£</th><th>è¿æ¥æ¨¡å¼</th></tr></thead><tbody><tr><td><code>DATABASE_URL</code></td><td>åº”ç”¨è¿è¡Œæ—¶æŸ¥è¯¢</td><td>6543</td><td>Transaction mode</td></tr><tr><td><code>DIRECT_URL</code></td><td>æ•°æ®åº“è¿ç§»</td><td>5432</td><td>Session mode</td></tr></tbody></table><p>ä¸¤è€…çš„åŒºåˆ«ï¼š</p><ul><li><strong>Transaction mode</strong>ï¼ˆ6543ï¼‰ï¼šé€‚åˆçŸ­è¿æ¥ï¼Œäº‹åŠ¡çº§åˆ«æ± åŒ–</li><li><strong>Session mode</strong>ï¼ˆ5432ï¼‰ï¼šé€‚åˆé•¿è¿æ¥ï¼Œä¼šè¯çº§åˆ«æ± åŒ–</li></ul><h3 id="prisma-schema-é…ç½®" tabindex="-1">Prisma Schema é…ç½® <a class="header-anchor" href="#prisma-schema-é…ç½®" aria-label="Permalink to &quot;Prisma Schema é…ç½®&quot;">â€‹</a></h3><p>ç¡®ä¿ä½ çš„ <code>apps/backend/prisma/schema.prisma</code> åŒ…å«ï¼š</p><div class="language-prisma vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">prisma</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">datasource</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  provider  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;postgresql&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  url       </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;DATABASE_URL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¿è¡Œæ—¶ä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  directUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;DIRECT_URL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¿ç§»æ—¶ä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="ğŸ”§-æµ‹è¯•è¿æ¥" tabindex="-1">ğŸ”§ æµ‹è¯•è¿æ¥ <a class="header-anchor" href="#ğŸ”§-æµ‹è¯•è¿æ¥" aria-label="Permalink to &quot;ğŸ”§ æµ‹è¯•è¿æ¥&quot;">â€‹</a></h2><h3 id="æ–¹æ³•-1-ä½¿ç”¨-prisma-studio" tabindex="-1">æ–¹æ³• 1ï¼šä½¿ç”¨ Prisma Studio <a class="header-anchor" href="#æ–¹æ³•-1-ä½¿ç”¨-prisma-studio" aria-label="Permalink to &quot;æ–¹æ³• 1ï¼šä½¿ç”¨ Prisma Studio&quot;">â€‹</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/backend</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> studio</span></span></code></pre></div><p>å¦‚æœèƒ½æ‰“å¼€æµè§ˆå™¨å¹¶çœ‹åˆ°æ•°æ®åº“è¡¨ï¼Œè¯´æ˜è¿æ¥æˆåŠŸã€‚</p><h3 id="æ–¹æ³•-2-æµ‹è¯•æ•°æ®åº“æ¨é€" tabindex="-1">æ–¹æ³• 2ï¼šæµ‹è¯•æ•°æ®åº“æ¨é€ <a class="header-anchor" href="#æ–¹æ³•-2-æµ‹è¯•æ•°æ®åº“æ¨é€" aria-label="Permalink to &quot;æ–¹æ³• 2ï¼šæµ‹è¯•æ•°æ®åº“æ¨é€&quot;">â€‹</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/backend</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span></span></code></pre></div><p>æˆåŠŸè¾“å‡ºï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>âœ” Your database is now in sync with your Prisma schema</span></span></code></pre></div><h3 id="æ–¹æ³•-3-å¯åŠ¨åº”ç”¨" tabindex="-1">æ–¹æ³• 3ï¼šå¯åŠ¨åº”ç”¨ <a class="header-anchor" href="#æ–¹æ³•-3-å¯åŠ¨åº”ç”¨" aria-label="Permalink to &quot;æ–¹æ³• 3ï¼šå¯åŠ¨åº”ç”¨&quot;">â€‹</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span></code></pre></div><p>æˆåŠŸè¾“å‡ºåº”åŒ…å«ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ</span></span></code></pre></div><hr><h2 id="ğŸ›-å¸¸è§é—®é¢˜æ’æŸ¥" tabindex="-1">ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥ <a class="header-anchor" href="#ğŸ›-å¸¸è§é—®é¢˜æ’æŸ¥" aria-label="Permalink to &quot;ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥&quot;">â€‹</a></h2><h3 id="é—®é¢˜-1-è¿æ¥è¶…æ—¶" tabindex="-1">é—®é¢˜ 1ï¼šè¿æ¥è¶…æ—¶ <a class="header-anchor" href="#é—®é¢˜-1-è¿æ¥è¶…æ—¶" aria-label="Permalink to &quot;é—®é¢˜ 1ï¼šè¿æ¥è¶…æ—¶&quot;">â€‹</a></h3><p><strong>é”™è¯¯ä¿¡æ¯</strong>ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Can&#39;t reach database server at \`pooler.supabase.com:6543\`</span></span></code></pre></div><p><strong>å¯èƒ½åŸå› </strong>ï¼š</p><ul><li>ç½‘ç»œé—®é¢˜ï¼Œæ— æ³•è®¿é—® Supabase</li><li>é˜²ç«å¢™é˜»æ­¢äº†ç«¯å£ 6543 æˆ– 5432</li><li>è¿æ¥å­—ç¬¦ä¸²é…ç½®é”™è¯¯</li></ul><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li>æ£€æŸ¥ç½‘ç»œè¿æ¥</li><li>å°è¯•åœ¨æµè§ˆå™¨è®¿é—® Supabase æ§åˆ¶å°ç¡®è®¤ç½‘ç»œç•…é€š</li><li>æ£€æŸ¥å…¬å¸/å­¦æ ¡ç½‘ç»œæ˜¯å¦æœ‰é˜²ç«å¢™é™åˆ¶</li><li>ç¡®è®¤è¿æ¥å­—ç¬¦ä¸²æ˜¯å¦ä» Supabase æ­£ç¡®å¤åˆ¶</li></ol><hr><h3 id="é—®é¢˜-2-è®¤è¯å¤±è´¥" tabindex="-1">é—®é¢˜ 2ï¼šè®¤è¯å¤±è´¥ <a class="header-anchor" href="#é—®é¢˜-2-è®¤è¯å¤±è´¥" aria-label="Permalink to &quot;é—®é¢˜ 2ï¼šè®¤è¯å¤±è´¥&quot;">â€‹</a></h3><p><strong>é”™è¯¯ä¿¡æ¯</strong>ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Authentication failed against database server</span></span></code></pre></div><p><strong>å¯èƒ½åŸå› </strong>ï¼š</p><ul><li>å¯†ç é”™è¯¯</li><li>å¯†ç åŒ…å«ç‰¹æ®Šå­—ç¬¦ä½†æœªç¼–ç </li><li>é¡¹ç›®å¼•ç”¨ï¼ˆrefï¼‰é”™è¯¯</li></ul><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li>åœ¨ Supabase æ§åˆ¶å° <strong>Settings â†’ Database</strong> é‡æ–°æŸ¥çœ‹å¯†ç </li><li>å¦‚æœå¿˜è®°å¯†ç ï¼Œå¯ä»¥ç‚¹å‡» <strong>Reset Database Password</strong> é‡ç½®</li><li>ç¡®ä¿ç‰¹æ®Šå­—ç¬¦å·²æ­£ç¡® URL ç¼–ç </li><li>ç¡®è®¤é¡¹ç›®å¼•ç”¨ï¼ˆ.xxxxx éƒ¨åˆ†ï¼‰æ˜¯å¦æ­£ç¡®</li></ol><hr><h3 id="é—®é¢˜-3-prisma-client-ç”Ÿæˆå¤±è´¥" tabindex="-1">é—®é¢˜ 3ï¼šPrisma Client ç”Ÿæˆå¤±è´¥ <a class="header-anchor" href="#é—®é¢˜-3-prisma-client-ç”Ÿæˆå¤±è´¥" aria-label="Permalink to &quot;é—®é¢˜ 3ï¼šPrisma Client ç”Ÿæˆå¤±è´¥&quot;">â€‹</a></h3><p><strong>é”™è¯¯ä¿¡æ¯</strong>ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>P1000: Authentication failed</span></span></code></pre></div><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. æ¸…é™¤ Prisma ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node_modules/.prisma</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. é‡æ–°ç”Ÿæˆ Prisma Client</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/backend</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> generate</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. æµ‹è¯•è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span></span></code></pre></div><hr><h3 id="é—®é¢˜-4-ipv6-é”™è¯¯" tabindex="-1">é—®é¢˜ 4ï¼šIPv6 é”™è¯¯ <a class="header-anchor" href="#é—®é¢˜-4-ipv6-é”™è¯¯" aria-label="Permalink to &quot;é—®é¢˜ 4ï¼šIPv6 é”™è¯¯&quot;">â€‹</a></h3><p><strong>é”™è¯¯ä¿¡æ¯</strong>ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>getaddrinfo ENOTFOUND db.xxxxx.supabase.co</span></span></code></pre></div><p><strong>åŸå› </strong>ï¼šå°è¯•ä½¿ç”¨ç›´è¿åœ°å€ä½†ç½‘ç»œä¸æ”¯æŒ IPv6</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š å¿…é¡»ä½¿ç”¨ Session Poolerï¼š</p><div class="language-env vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">env</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>DATABASE_URL=&quot;postgresql://...@aws-x-region.pooler.supabase.com:6543/...&quot;</span></span>
<span class="line"><span>DIRECT_URL=&quot;postgresql://...@aws-x-region.pooler.supabase.com:5432/...&quot;</span></span></code></pre></div><hr><h2 id="ğŸ“Š-è¿æ¥æ± é…ç½®è¯´æ˜" tabindex="-1">ğŸ“Š è¿æ¥æ± é…ç½®è¯´æ˜ <a class="header-anchor" href="#ğŸ“Š-è¿æ¥æ± é…ç½®è¯´æ˜" aria-label="Permalink to &quot;ğŸ“Š è¿æ¥æ± é…ç½®è¯´æ˜&quot;">â€‹</a></h2><h3 id="transaction-mode-æ¨è" tabindex="-1">Transaction Mode (æ¨è) <a class="header-anchor" href="#transaction-mode-æ¨è" aria-label="Permalink to &quot;Transaction Mode (æ¨è)&quot;">â€‹</a></h3><p><strong>ç«¯å£</strong>ï¼š6543 <strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>æ¯ä¸ªäº‹åŠ¡ä½¿ç”¨ä¸€ä¸ªè¿æ¥</li><li>é€‚åˆçŸ­æŸ¥è¯¢</li><li>è¿æ¥æ•°é™åˆ¶è¾ƒå°‘</li><li><strong>æ¨èç”¨äº Prisma</strong></li></ul><p><strong>è¿æ¥å­—ç¬¦ä¸²ç¤ºä¾‹</strong>ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>postgresql://...@pooler.supabase.com:6543/postgres?pgbouncer=true&amp;connection_limit=1</span></span></code></pre></div><h3 id="session-mode" tabindex="-1">Session Mode <a class="header-anchor" href="#session-mode" aria-label="Permalink to &quot;Session Mode&quot;">â€‹</a></h3><p><strong>ç«¯å£</strong>ï¼š5432 <strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>æ¯ä¸ªä¼šè¯ä½¿ç”¨ä¸€ä¸ªè¿æ¥</li><li>é€‚åˆé•¿æŸ¥è¯¢å’Œè¿ç§»</li><li>æ”¯æŒæ‰€æœ‰ PostgreSQL ç‰¹æ€§</li><li><strong>ç”¨äº Prisma Migrate</strong></li></ul><p><strong>è¿æ¥å­—ç¬¦ä¸²ç¤ºä¾‹</strong>ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>postgresql://...@pooler.supabase.com:5432/postgres</span></span></code></pre></div><hr><h2 id="ğŸ”’-å®‰å…¨å»ºè®®" tabindex="-1">ğŸ”’ å®‰å…¨å»ºè®® <a class="header-anchor" href="#ğŸ”’-å®‰å…¨å»ºè®®" aria-label="Permalink to &quot;ğŸ”’ å®‰å…¨å»ºè®®&quot;">â€‹</a></h2><ol><li><p><strong>æ°¸è¿œä¸è¦å°† <code>.env</code> æ–‡ä»¶æäº¤åˆ° Git</strong></p><ul><li><code>.env</code> å·²åœ¨ <code>.gitignore</code> ä¸­</li><li>ä½¿ç”¨ <code>.env.example</code> ä½œä¸ºæ¨¡æ¿</li></ul></li><li><p><strong>ä½¿ç”¨å¼ºå¯†ç </strong></p><ul><li>è‡³å°‘ 16 ä¸ªå­—ç¬¦</li><li>åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦</li><li>ä¸è¦ä½¿ç”¨å¸¸è§å•è¯</li></ul></li><li><p><strong>å®šæœŸè½®æ¢å¯†é’¥</strong></p><ul><li>JWT_SECRET å®šæœŸæ›´æ¢</li><li>æ•°æ®åº“å¯†ç å®šæœŸæ›´æ–°</li></ul></li><li><p><strong>ç”Ÿäº§ç¯å¢ƒ</strong></p><ul><li>ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡</li><li>ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥</li><li>å¯ç”¨ Supabase çš„ IP ç™½åå•ï¼ˆå¦‚æœå¯ç”¨ï¼‰</li></ul></li></ol><hr><h2 id="ğŸ“š-ç›¸å…³æ–‡æ¡£" tabindex="-1">ğŸ“š ç›¸å…³æ–‡æ¡£ <a class="header-anchor" href="#ğŸ“š-ç›¸å…³æ–‡æ¡£" aria-label="Permalink to &quot;ğŸ“š ç›¸å…³æ–‡æ¡£&quot;">â€‹</a></h2><ul><li><a href="https://supabase.com/docs" target="_blank" rel="noreferrer">Supabase å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://www.prisma.io/docs" target="_blank" rel="noreferrer">Prisma å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://www.pgbouncer.org/" target="_blank" rel="noreferrer">PostgreSQL è¿æ¥æ± </a></li></ul><hr><h2 id="ğŸ’¡-æœ€ä½³å®è·µ" tabindex="-1">ğŸ’¡ æœ€ä½³å®è·µ <a class="header-anchor" href="#ğŸ’¡-æœ€ä½³å®è·µ" aria-label="Permalink to &quot;ğŸ’¡ æœ€ä½³å®è·µ&quot;">â€‹</a></h2><h3 id="å¼€å‘ç¯å¢ƒ" tabindex="-1">å¼€å‘ç¯å¢ƒ <a class="header-anchor" href="#å¼€å‘ç¯å¢ƒ" aria-label="Permalink to &quot;å¼€å‘ç¯å¢ƒ&quot;">â€‹</a></h3><div class="language-env vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">env</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># ä½¿ç”¨ Transaction mode</span></span>
<span class="line"><span>DATABASE_URL=&quot;postgresql://...@pooler.supabase.com:6543/postgres?pgbouncer=true&quot;</span></span>
<span class="line"><span>DIRECT_URL=&quot;postgresql://...@pooler.supabase.com:5432/postgres&quot;</span></span></code></pre></div><h3 id="ç”Ÿäº§ç¯å¢ƒ" tabindex="-1">ç”Ÿäº§ç¯å¢ƒ <a class="header-anchor" href="#ç”Ÿäº§ç¯å¢ƒ" aria-label="Permalink to &quot;ç”Ÿäº§ç¯å¢ƒ&quot;">â€‹</a></h3><div class="language-env vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">env</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 1. ä½¿ç”¨ç¯å¢ƒå˜é‡</span></span>
<span class="line"><span># 2. å¯ç”¨ SSL</span></span>
<span class="line"><span>DATABASE_URL=&quot;postgresql://...@pooler.supabase.com:6543/postgres?pgbouncer=true&amp;sslmode=require&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 3. å¢åŠ è¿æ¥é™åˆ¶ï¼ˆå¯é€‰ï¼‰</span></span>
<span class="line"><span>DATABASE_URL=&quot;postgresql://...@pooler.supabase.com:6543/postgres?pgbouncer=true&amp;connection_limit=10&quot;</span></span></code></pre></div><hr><h2 id="âœ…-é…ç½®æ£€æŸ¥æ¸…å•" tabindex="-1">âœ… é…ç½®æ£€æŸ¥æ¸…å• <a class="header-anchor" href="#âœ…-é…ç½®æ£€æŸ¥æ¸…å•" aria-label="Permalink to &quot;âœ… é…ç½®æ£€æŸ¥æ¸…å•&quot;">â€‹</a></h2><p>åœ¨å¯åŠ¨åº”ç”¨å‰ï¼Œè¯·ç¡®è®¤ï¼š</p><ul><li>[ ] Supabase é¡¹ç›®å·²åˆ›å»º</li><li>[ ] æ•°æ®åº“å¯†ç å·²ä¿å­˜</li><li>[ ] è·å–äº†æ­£ç¡®çš„è¿æ¥å­—ç¬¦ä¸²ï¼ˆå¸¦ pooler.supabase.comï¼‰</li><li>[ ] å¯†ç ä¸­çš„ç‰¹æ®Šå­—ç¬¦å·² URL ç¼–ç </li><li>[ ] <code>.env</code> æ–‡ä»¶å·²æ­£ç¡®é…ç½®</li><li>[ ] <code>DATABASE_URL</code> å’Œ <code>DIRECT_URL</code> éƒ½å·²è®¾ç½®</li><li>[ ] Prisma schema ä¸­åŒ…å« <code>directUrl</code></li><li>[ ] å·²è¿è¡Œ <code>npx prisma generate</code></li><li>[ ] å·²è¿è¡Œ <code>npx prisma db push</code> æˆåŠŸ</li></ul><hr><p>å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒ <a href="./README.html">README.md</a> æˆ–æäº¤ <a href="https://github.com/your-repo/issues" target="_blank" rel="noreferrer">GitHub Issue</a>ã€‚</p>`,110)])])}const u=a(n,[["render",l]]);export{g as __pageData,u as default};
