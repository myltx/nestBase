import{_ as e,c as l,o as a,a0 as o}from"./chunks/framework.CHkYM5Ax.js";const f=JSON.parse('{"title":"接口精简与优化分析报告 (Phase 2)","description":"","frontmatter":{},"headers":[],"relativePath":"plans/api_refactor_tags_logs_categories_plan.md","filePath":"plans/api_refactor_tags_logs_categories_plan.md","lastUpdated":1766977345000}'),s={name:"plans/api_refactor_tags_logs_categories_plan.md"};function d(i,t,r,n,g,c){return a(),l("div",null,[...t[0]||(t[0]=[o('<h1 id="接口精简与优化分析报告-phase-2" tabindex="-1">接口精简与优化分析报告 (Phase 2) <a class="header-anchor" href="#接口精简与优化分析报告-phase-2" aria-label="Permalink to &quot;接口精简与优化分析报告 (Phase 2)&quot;">​</a></h1><h2 id="_1-背景与目标" tabindex="-1">1. 背景与目标 <a class="header-anchor" href="#_1-背景与目标" aria-label="Permalink to &quot;1. 背景与目标&quot;">​</a></h2><p>这是 API 接口优化的第二阶段，覆盖 <code>Projects</code>、<code>Contents</code>、<code>Categories</code>、<code>Tags</code>、<code>Logs</code>、<code>Audit</code>、<code>System</code> 及 <code>Auth</code> 模块。 目标同第一阶段：<strong>在不降低系统能力的前提下，最大限度精简接口数量</strong>，统一设计风格。</p><hr><h2 id="_2-模块分析与优化建议" tabindex="-1">2. 模块分析与优化建议 <a class="header-anchor" href="#_2-模块分析与优化建议" aria-label="Permalink to &quot;2. 模块分析与优化建议&quot;">​</a></h2><h3 id="_2-1-tags-标签模块" tabindex="-1">2.1 Tags（标签模块） <a class="header-anchor" href="#_2-1-tags-标签模块" aria-label="Permalink to &quot;2.1 Tags（标签模块）&quot;">​</a></h3><h4 id="现状与问题" tabindex="-1">现状与问题 <a class="header-anchor" href="#现状与问题" aria-label="Permalink to &quot;现状与问题&quot;">​</a></h4><ul><li><strong>接口冗余</strong>: <ul><li><code>GET /tags/page</code>: 分页查询接口，与 <code>GET /tags</code> (findAll) 功能重叠。</li><li><code>GET /tags/popular</code>: 热门标签接口，本质是按特定排序规则（usage count）查询。</li></ul></li><li><strong>批量操作独立</strong>: <code>POST /tags/batch</code> 独立于创建接口。</li></ul><h4 id="优化建议" tabindex="-1">优化建议 <a class="header-anchor" href="#优化建议" aria-label="Permalink to &quot;优化建议&quot;">​</a></h4><ol><li><strong>合并查询接口</strong>: 移除 <code>/tags/page</code> 和 <code>/tags/popular</code>。统一使用 <code>GET /tags</code>。 <ul><li>增加查询参数: <code>?sort=popular</code> (热门), <code>?current=1&amp;size=10</code> (分页)。</li><li>如果未传分页参数，返回全量（适合下拉选择）；传了则分页。</li></ul></li><li><strong>标准化批量创建</strong>: <code>POST /tags</code> 既支持单个对象，也支持对象数组（或者保留 <code>batch</code> 但建议前端统一调用方式）。考虑到 RESTful 语义，保持单数 <code>POST /tags</code> 最纯粹，批量可作为特殊 Payload 或保持现状。考虑到管理后台导入场景，<strong>建议保留 /batch 但归类到 Import 功能</strong>，或者通过重载 <code>POST</code> 支持数组。鉴于 NestJS DTO 校验方便，<strong>推荐保持 batch 或支持数组</strong>。为了极简，可以合并，但批量创建有时需要不同的返回格式（成功/失败数量）。<strong>建议：</strong> 暂时保留 <code>batch</code> 作为一个明确的功能点，或者合并但需复杂化 DTO。 <ul><li><em>推荐</em>: 移除 <code>GET /tags/page</code>, <code>GET /tags/popular</code> -&gt; <code>GET /tags?sort=popular&amp;page=1</code>。</li></ul></li></ol><h4 id="推荐接口设计" tabindex="-1">推荐接口设计 <a class="header-anchor" href="#推荐接口设计" aria-label="Permalink to &quot;推荐接口设计&quot;">​</a></h4><table tabindex="0"><thead><tr><th style="text-align:left;">动作</th><th style="text-align:left;">原接口</th><th style="text-align:left;">优化后</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;">查询列表/分页</td><td style="text-align:left;">GET /tags/page</td><td style="text-align:left;">GET /tags</td><td style="text-align:left;">通过 <code>current/size</code> 区分是否分页</td></tr><tr><td style="text-align:left;">查询热门</td><td style="text-align:left;">GET /tags/popular</td><td style="text-align:left;">GET /tags?sort=popular</td><td style="text-align:left;">通过排序参数实现</td></tr><tr><td style="text-align:left;">创建</td><td style="text-align:left;">POST /tags</td><td style="text-align:left;">POST /tags</td><td style="text-align:left;">保持不变</td></tr><tr><td style="text-align:left;">批量创建</td><td style="text-align:left;">POST /tags/batch</td><td style="text-align:left;">POST /tags/batch</td><td style="text-align:left;">建议保留，明确语义</td></tr><tr><td style="text-align:left;">详情/更新/删除</td><td style="text-align:left;">...</td><td style="text-align:left;">...</td><td style="text-align:left;">保持不变</td></tr></tbody></table><hr><h3 id="_2-2-logs-audit-日志模块" tabindex="-1">2.2 Logs &amp; Audit（日志模块） <a class="header-anchor" href="#_2-2-logs-audit-日志模块" aria-label="Permalink to &quot;2.2 Logs &amp; Audit（日志模块）&quot;">​</a></h3><h4 id="现状与问题-1" tabindex="-1">现状与问题 <a class="header-anchor" href="#现状与问题-1" aria-label="Permalink to &quot;现状与问题&quot;">​</a></h4><ul><li><strong>Logs 分类拆分</strong>: <code>LogsController</code> 将访问日志和登录日志拆分为 <code>/logs/access</code> and <code>/logs/login</code> 及其各自的 stats 接口。</li><li><strong>Audit 独立</strong>: <code>AuditController</code> 独立管理审计日志。</li><li><strong>统计接口独立</strong>: <code>access/stats</code>, <code>login/stats</code>。</li></ul><h4 id="优化建议-1" tabindex="-1">优化建议 <a class="header-anchor" href="#优化建议-1" aria-label="Permalink to &quot;优化建议&quot;">​</a></h4><ol><li><strong>合并 Login/Access 日志</strong>: 它们结构相似，都是系统日志。可以合并为 <code>GET /logs</code>，通过 <code>?type=ACCESS|LOGIN</code> 区分。 <ul><li><strong>优点</strong>: 前端日志组件可复用，只需切换 type 参数。</li></ul></li><li><strong>统计接口合并</strong>: <code>GET /logs/stats?type=...</code>。</li><li><strong>Audit 日志</strong>: 审计日志通常结构较特殊（记录 diff），且业务含义重（操作审计 vs 系统流水），<strong>建议保持 Audit 独立</strong>，但 <code>AuditController</code> 接口已很精简，无需变动。</li></ol><h4 id="推荐接口设计-1" tabindex="-1">推荐接口设计 <a class="header-anchor" href="#推荐接口设计-1" aria-label="Permalink to &quot;推荐接口设计&quot;">​</a></h4><table tabindex="0"><thead><tr><th style="text-align:left;">动作</th><th style="text-align:left;">原接口</th><th style="text-align:left;">优化后</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;">访问日志列表</td><td style="text-align:left;">GET /logs/access</td><td style="text-align:left;">GET /logs?type=ACCESS</td><td style="text-align:left;">合并</td></tr><tr><td style="text-align:left;">登录日志列表</td><td style="text-align:left;">GET /logs/login</td><td style="text-align:left;">GET /logs?type=LOGIN</td><td style="text-align:left;">合并</td></tr><tr><td style="text-align:left;">访问日志统计</td><td style="text-align:left;">GET /logs/access/stats</td><td style="text-align:left;">GET /logs/stats?type=ACCESS</td><td style="text-align:left;">合并</td></tr><tr><td style="text-align:left;">登录日志统计</td><td style="text-align:left;">GET /logs/login/stats</td><td style="text-align:left;">GET /logs/stats?type=LOGIN</td><td style="text-align:left;">合并</td></tr></tbody></table><hr><h3 id="_2-3-categories-分类模块" tabindex="-1">2.3 Categories（分类模块） <a class="header-anchor" href="#_2-3-categories-分类模块" aria-label="Permalink to &quot;2.3 Categories（分类模块）&quot;">​</a></h3><h4 id="现状与问题-2" tabindex="-1">现状与问题 <a class="header-anchor" href="#现状与问题-2" aria-label="Permalink to &quot;现状与问题&quot;">​</a></h4><ul><li><strong>列表结构拆分</strong>: <code>GET /categories</code> (树形) vs <code>GET /categories/flat</code> (扁平)。</li><li><strong>Slug 查询独立</strong>: <code>GET /categories/slug/:slug</code>。</li></ul><h4 id="优化建议-2" tabindex="-1">优化建议 <a class="header-anchor" href="#优化建议-2" aria-label="Permalink to &quot;优化建议&quot;">​</a></h4><ol><li><strong>合并列表接口</strong>: 统一使用 <code>GET /categories</code>。 <ul><li>增加参数 <code>?format=tree|flat</code> (默认 tree)。</li></ul></li><li><strong>移除 Slug 查询</strong>: 用户确认目前该功能未使用。直接移除 <code>GET /categories/slug/:slug</code>。</li></ol><h4 id="推荐接口设计-2" tabindex="-1">推荐接口设计 <a class="header-anchor" href="#推荐接口设计-2" aria-label="Permalink to &quot;推荐接口设计&quot;">​</a></h4><table tabindex="0"><thead><tr><th style="text-align:left;">动作</th><th style="text-align:left;">原接口</th><th style="text-align:left;">优化后</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;">树形列表</td><td style="text-align:left;">GET /categories</td><td style="text-align:left;">GET /categories</td><td style="text-align:left;">默认返回 Tree</td></tr><tr><td style="text-align:left;">扁平列表</td><td style="text-align:left;">GET /categories/flat</td><td style="text-align:left;">GET /categories?format=flat</td><td style="text-align:left;">参数控制</td></tr><tr><td style="text-align:left;">Slug 查询</td><td style="text-align:left;">GET /categories/slug/:slug</td><td style="text-align:left;">-</td><td style="text-align:left;"><strong>移除</strong> (未使用)</td></tr></tbody></table><hr><h3 id="_2-4-projects-contents-内容类模块" tabindex="-1">2.4 Projects &amp; Contents（内容类模块） <a class="header-anchor" href="#_2-4-projects-contents-内容类模块" aria-label="Permalink to &quot;2.4 Projects &amp; Contents（内容类模块）&quot;">​</a></h3><h4 id="现状与问题-3" tabindex="-1">现状与问题 <a class="header-anchor" href="#现状与问题-3" aria-label="Permalink to &quot;现状与问题&quot;">​</a></h4><ul><li><strong>Action 接口</strong>: <ul><li>Projects: <code>getTechStack</code> (独立资源，OK).</li><li>Contents: 目前主要是 CRUD。</li></ul></li><li><strong>观察</strong>: 内容管理通常会有 <code>publish</code>, <code>archive</code>, <code>feature</code> 等操作。目前 Controller 中主要是基础 CRUD。如果未来有这些需求，<strong>严禁新增 <code>/contents/:id/publish</code> 接口</strong>。</li><li><strong>优化预案</strong>: 状态变更统一走 <code>PATCH /contents/:id</code>。</li></ul><h4 id="推荐接口设计-3" tabindex="-1">推荐接口设计 <a class="header-anchor" href="#推荐接口设计-3" aria-label="Permalink to &quot;推荐接口设计&quot;">​</a></h4><ul><li><strong>Projects</strong>: 保持现状。<code>getTechStack</code> 是特定聚合，保留。</li><li><strong>Contents</strong>: 保持现状，确保 <code>findOne</code> 的 <code>view</code> 参数逻辑清晰（目前已实现）。</li></ul><hr><h3 id="_2-5-auth-system-基础模块" tabindex="-1">2.5 Auth &amp; System（基础模块） <a class="header-anchor" href="#_2-5-auth-system-基础模块" aria-label="Permalink to &quot;2.5 Auth &amp; System（基础模块）&quot;">​</a></h3><h4 id="现状与问题-4" tabindex="-1">现状与问题 <a class="header-anchor" href="#现状与问题-4" aria-label="Permalink to &quot;现状与问题&quot;">​</a></h4><ul><li><strong>System</strong>: <code>GET /system/status</code> 很标准。</li><li><strong>Auth</strong>: <ul><li><code>permissions</code> (获取用户权限): 独立接口。</li><li><code>profile</code>: 获取用户信息。</li><li><em>思考</em>: <code>profile</code> 是否应该包含 <code>permissions</code>？</li><li><em>场景</em>: 登录后初始化 Store，需要 UserInfo + Permissions + Menus。</li><li><em>建议</em>: 保持独立。因为 <code>Menus</code> 也是独立的，Permissions 也是独立的，Profile 也是独立的。合并虽然减少请求，但耦合度高。或者提供一个 <code>GET /auth/bootstrap</code> 聚合所有初始数据。</li><li><em>决策</em>: 目前 Auth 接口职责清晰，无需强制合并。</li></ul></li></ul><hr><h2 id="_3-总体调整汇总表" tabindex="-1">3. 总体调整汇总表 <a class="header-anchor" href="#_3-总体调整汇总表" aria-label="Permalink to &quot;3. 总体调整汇总表&quot;">​</a></h2><table tabindex="0"><thead><tr><th style="text-align:left;">模块</th><th style="text-align:left;">调整项</th><th style="text-align:left;">涉及接口数 (减)</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>Tags</strong></td><td style="text-align:left;">合并 Page/Popular</td><td style="text-align:left;">-2</td><td style="text-align:left;">统一至 <code>findAll</code></td></tr><tr><td style="text-align:left;"><strong>Logs</strong></td><td style="text-align:left;">合并 Access/Login</td><td style="text-align:left;">-2</td><td style="text-align:left;">统一至 <code>findAll</code> + type</td></tr><tr><td style="text-align:left;"><strong>Logs</strong></td><td style="text-align:left;">合并 Stats</td><td style="text-align:left;">-1</td><td style="text-align:left;">统一至 <code>stats</code> + type</td></tr><tr><td style="text-align:left;"><strong>Categories</strong></td><td style="text-align:left;">合并 Flat/Tree</td><td style="text-align:left;">-1</td><td style="text-align:left;">统一至 <code>findAll</code> + format</td></tr><tr><td style="text-align:left;"><strong>Categories</strong></td><td style="text-align:left;">移除 Slug 独立接口</td><td style="text-align:left;">-1</td><td style="text-align:left;">统一至 <code>findAll</code> + slug query</td></tr></tbody></table><p><strong>预计总减少接口数量: ~7 个</strong></p><h2 id="_4-代码调整建议" tabindex="-1">4. 代码调整建议 <a class="header-anchor" href="#_4-代码调整建议" aria-label="Permalink to &quot;4. 代码调整建议&quot;">​</a></h2><ol><li><strong>TagsService</strong>: <ul><li>重构 <code>findAll</code> 支持 <code>QueryTagDto</code> (包含 page, size, sort, search)。</li></ul></li><li><strong>LogsService</strong>: <ul><li>创建通用 <code>findAll(type, query)</code> 方法。</li><li>创建通用 <code>getStats(type, ...)</code> 方法。</li></ul></li><li><strong>CategoriesService</strong>: <ul><li><code>findAll</code> 增加 <code>format</code> 参数处理。</li></ul></li></ol>',44)])])}const u=e(s,[["render",d]]);export{f as __pageData,u as default};
