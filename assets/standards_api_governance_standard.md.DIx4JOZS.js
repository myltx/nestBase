import{_ as e,c as t,o as a,a0 as i}from"./chunks/framework.CHkYM5Ax.js";const g=JSON.parse('{"title":"接口治理与收敛规范文档 (API Governance & Convergence Standard)","description":"","frontmatter":{},"headers":[],"relativePath":"standards/api_governance_standard.md","filePath":"standards/api_governance_standard.md","lastUpdated":1766977345000}'),n={name:"standards/api_governance_standard.md"};function l(d,s,o,r,p,c){return a(),t("div",null,[...s[0]||(s[0]=[i(`<h1 id="接口治理与收敛规范文档-api-governance-convergence-standard" tabindex="-1">接口治理与收敛规范文档 (API Governance &amp; Convergence Standard) <a class="header-anchor" href="#接口治理与收敛规范文档-api-governance-convergence-standard" aria-label="Permalink to &quot;接口治理与收敛规范文档 (API Governance &amp; Convergence Standard)&quot;">​</a></h1><h2 id="_1-核心原则-core-principles" tabindex="-1">1. 核心原则 (Core Principles) <a class="header-anchor" href="#_1-核心原则-core-principles" aria-label="Permalink to &quot;1. 核心原则 (Core Principles)&quot;">​</a></h2><p>本规范旨在建立一套<strong>可长期演进、低心智负担、风格统一</strong>的 RESTful API 体系。所有新功能开发与旧功能重构必须遵循以下原则：</p><ol><li><strong>资源导向 (Resource-Oriented)</strong>: URL 应名词化，代表资源实体，而非动词化的操作（Action）。</li><li><strong>方法对应 (Method Mapping)</strong>: 严格使用 HTTP Method 表达操作意图 (<code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>PATCH</code>, <code>DELETE</code>)。</li><li><strong>控制层精简 (Thin Controller)</strong>: Controller 仅负责参数校验、权限代理与响应格式化，业务逻辑下沉至 Service。</li><li><strong>参数标准化 (Standardized Review)</strong>: 分页、排序、筛选、树形/扁平格式控制必须使用统一的参数命名。</li></ol><hr><h2 id="_2-接口设计规范-interface-design-standards" tabindex="-1">2. 接口设计规范 (Interface Design Standards) <a class="header-anchor" href="#_2-接口设计规范-interface-design-standards" aria-label="Permalink to &quot;2. 接口设计规范 (Interface Design Standards)&quot;">​</a></h2><h3 id="_2-1-基础-crud-命名约定" tabindex="-1">2.1 基础 CRUD 命名约定 <a class="header-anchor" href="#_2-1-基础-crud-命名约定" aria-label="Permalink to &quot;2.1 基础 CRUD 命名约定&quot;">​</a></h3><p>所有模块的基础实体（如 <code>projects</code>, <code>tags</code>）必须遵循以下标准命名与签名：</p><table tabindex="0"><thead><tr><th style="text-align:left;">操作类型</th><th style="text-align:left;">HTTP 方法</th><th style="text-align:left;">URL 路径</th><th style="text-align:left;">方法名 (Controller)</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>查询列表</strong></td><td style="text-align:left;"><code>GET</code></td><td style="text-align:left;"><code>/{resources}</code></td><td style="text-align:left;"><code>findAll</code></td><td style="text-align:left;">支持分页、搜索、排序、格式控制</td></tr><tr><td style="text-align:left;"><strong>查询单个</strong></td><td style="text-align:left;"><code>GET</code></td><td style="text-align:left;"><code>/{resources}/:id</code></td><td style="text-align:left;"><code>findOne</code></td><td style="text-align:left;">根据 ID 获取详情</td></tr><tr><td style="text-align:left;"><strong>创建</strong></td><td style="text-align:left;"><code>POST</code></td><td style="text-align:left;"><code>/{resources}</code></td><td style="text-align:left;"><code>create</code></td><td style="text-align:left;">创建新资源</td></tr><tr><td style="text-align:left;"><strong>更新</strong></td><td style="text-align:left;"><code>PATCH</code></td><td style="text-align:left;"><code>/{resources}/:id</code></td><td style="text-align:left;"><code>update</code></td><td style="text-align:left;">局部更新 (推荐)，仅更新传入字段</td></tr><tr><td style="text-align:left;"><strong>全量替换</strong></td><td style="text-align:left;"><code>PUT</code></td><td style="text-align:left;"><code>/{resources}/:id</code></td><td style="text-align:left;"><code>replace</code></td><td style="text-align:left;">(不常用) 只有在完全替换资源时使用</td></tr><tr><td style="text-align:left;"><strong>删除</strong></td><td style="text-align:left;"><code>DELETE</code></td><td style="text-align:left;"><code>/{resources}/:id</code></td><td style="text-align:left;"><code>remove</code></td><td style="text-align:left;">删除资源</td></tr></tbody></table><p><strong>禁止事项</strong>:</p><ul><li>❌ 禁止使用 <code>POST /{path}/list</code> 来获取列表（除非参数过于复杂超过 URL 长度限制）。</li><li>❌ 禁止使用 <code>GET /{path}/delete</code> 触发删除。</li><li>❌ 禁止在 Controller 中定义 <code>getById</code>, <code>updateInfo</code> 等非标准命名，统一为 <code>findOne</code>, <code>update</code>。</li></ul><h3 id="_2-2-状态与业务操作-status-actions" tabindex="-1">2.2 状态与业务操作 (Status &amp; Actions) <a class="header-anchor" href="#_2-2-状态与业务操作-status-actions" aria-label="Permalink to &quot;2.2 状态与业务操作 (Status &amp; Actions)&quot;">​</a></h3><p>对于 <code>enable/disable</code>, <code>publish/unpublish</code> 等状态变更，优先推荐<strong>资源更新模式</strong>，而非<strong>动作模式</strong>。</p><ul><li><strong>✅ 推荐</strong>: <code>PATCH /contents/:id</code> Body: <code>{ &quot;status&quot;: &quot;PUBLISHED&quot; }</code></li><li><strong>❌ 避免</strong>: <code>POST /contents/:id/publish</code> 或 <code>PUT /contents/:id/status</code></li></ul><p><strong>例外情况</strong>: 当操作包含复杂业务逻辑（不仅仅是改字段），且无法通过 DTO 简单表达时，可使用<strong>子资源</strong>或<strong>特定动作</strong>模式，但需保持全局统一：</p><ul><li><strong>动作模式</strong>: <code>POST /{resources}/:id/actions/{actionName}</code> (e.g. <code>POST /vms/:id/actions/restart</code>)</li><li><strong>子资源模式</strong>: <code>POST /{resources}/:id/view-records</code> (e.g. 增加浏览记录)</li></ul><h3 id="_2-3-关联关系处理-relationships" tabindex="-1">2.3 关联关系处理 (Relationships) <a class="header-anchor" href="#_2-3-关联关系处理-relationships" aria-label="Permalink to &quot;2.3 关联关系处理 (Relationships)&quot;">​</a></h3><p>对于多对多关系（如 用户&lt;-&gt;角色），推荐使用<strong>主资源下的子资源路径</strong>：</p><table tabindex="0"><thead><tr><th style="text-align:left;">操作</th><th style="text-align:left;">路径</th><th style="text-align:left;">语义</th><th style="text-align:left;">现有示例</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>查询关联</strong></td><td style="text-align:left;"><code>GET /{parents}/:id/{children}</code></td><td style="text-align:left;">获取父资源下的子资源列表</td><td style="text-align:left;"><code>GET /roles/:id/users</code></td></tr><tr><td style="text-align:left;"><strong>添加关联</strong></td><td style="text-align:left;"><code>POST /{parents}/:id/{children}</code></td><td style="text-align:left;">批量/单条添加关联</td><td style="text-align:left;"><code>POST /roles/:id/users</code></td></tr><tr><td style="text-align:left;"><strong>移除关联</strong></td><td style="text-align:left;"><code>DELETE /{parents}/:id/{children}</code></td><td style="text-align:left;">批量/单条移除关联</td><td style="text-align:left;"><code>DELETE /roles/:id/users</code></td></tr></tbody></table><p><strong>注意</strong>: 若关联关系极为复杂且独立，可考虑抽象为独立资源（<code>UserRoles</code>），但在 URL 上仍应体现层级。</p><h3 id="_2-4-批量操作-batch-operations" tabindex="-1">2.4 批量操作 (Batch Operations) <a class="header-anchor" href="#_2-4-批量操作-batch-operations" aria-label="Permalink to &quot;2.4 批量操作 (Batch Operations)&quot;">​</a></h3><p>批量操作应由 Collection 级接口处理：</p><ul><li><strong>批量创建</strong>: <code>POST /{resources}/batch</code></li><li><strong>批量删除</strong>: <ul><li>方案 A (推荐): <code>POST /{resources}/batch-delete</code> Body: <code>{ ids: [] }</code> (避免 DELETE 带 Body 的兼容性问题)</li><li>方案 B (内部): <code>DELETE /{resources}</code> Body: <code>{ ids: [] }</code> (需确认网关/代理支持)</li></ul></li></ul><hr><h2 id="_3-参数与响应规范-dto-response" tabindex="-1">3. 参数与响应规范 (DTO &amp; Response) <a class="header-anchor" href="#_3-参数与响应规范-dto-response" aria-label="Permalink to &quot;3. 参数与响应规范 (DTO &amp; Response)&quot;">​</a></h2><h3 id="_3-1-统一查询参数-query-dto" tabindex="-1">3.1 统一查询参数 (Query DTO) <a class="header-anchor" href="#_3-1-统一查询参数-query-dto" aria-label="Permalink to &quot;3.1 统一查询参数 (Query DTO)&quot;">​</a></h3><p>所有 <code>findAll</code> 接口应继承或实现统一的查询接口：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> QueryBaseDto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 分页</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApiProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ required: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  current</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 页码，默认 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApiProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ required: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 页大小，默认 10</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 排序</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApiProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ required: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, description: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;sort=createdAt:desc&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  sort</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 关键词搜索</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApiProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ required: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  search</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 通用模糊搜索</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 数据格式 return type</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApiProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ enum: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;tree&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;flat&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] })</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  format</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;tree&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;flat&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 针对树形数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_3-2-统一响应结构" tabindex="-1">3.2 统一响应结构 <a class="header-anchor" href="#_3-2-统一响应结构" aria-label="Permalink to &quot;3.2 统一响应结构&quot;">​</a></h3><p>Controller 返回纯数据或 DTO，由 Global Interceptor 统一包装为 <code>{ code, data, message }</code>。 <strong>禁止</strong>在 Controller 中手动包裹 <code>{ data: ... }</code>。</p><hr><h2 id="_4-全局接口收敛清单-consolidation-guidelines" tabindex="-1">4. 全局接口收敛清单 (Consolidation Guidelines) <a class="header-anchor" href="#_4-全局接口收敛清单-consolidation-guidelines" aria-label="Permalink to &quot;4. 全局接口收敛清单 (Consolidation Guidelines)&quot;">​</a></h2><p>基于前几轮分析，以下模式需要持续收敛：</p><ol><li><p><strong>合并相似的列表查询</strong>:</p><ul><li>场景: 有 <code>findAll</code>, <code>findActive</code>, <code>findPopular</code> 等多个接口。</li><li>对策: 合并为 <code>findAll</code>，通过 Query 参数 <code>?status=active</code>, <code>?sort=popular</code> 区分。</li></ul></li><li><p><strong>收敛独立的统计接口</strong>:</p><ul><li>场景: 每个模块都有 <code>/stats</code> 且格式各异。</li><li>对策: 若统计简单，可作为 <code>findAll</code> 的元数据返回；若复杂，统一为 <code>GET /{resources}/stats</code>，参数保持一致。</li></ul></li><li><p><strong>移除 &quot;Getter/Setter&quot; 风格接口</strong>:</p><ul><li>场景: <code>getRoleMenus</code>, <code>assignMenus</code>, <code>resetPassword</code>。</li><li>对策: <ul><li><code>resetPassword</code> -&gt; <code>PATCH /users/:id</code> (字段 <code>password</code>)</li><li><code>assignMenus</code> -&gt; <code>PUT /roles/:id</code> (字段 <code>menuIds</code> 全量覆盖) 或 <code>POST /roles/:id/menus</code> (增量)</li></ul></li></ul></li></ol><h2 id="_5-项目结构建议" tabindex="-1">5. 项目结构建议 <a class="header-anchor" href="#_5-项目结构建议" aria-label="Permalink to &quot;5. 项目结构建议&quot;">​</a></h2><p>建议逐步调整文件夹结构以反映资源关系而非功能模块：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>modules/</span></span>
<span class="line"><span>  ├── users/          # 用户主体</span></span>
<span class="line"><span>  │   ├── users.controller.ts</span></span>
<span class="line"><span>  │   └── ...</span></span>
<span class="line"><span>  ├── roles/          # 角色主体</span></span>
<span class="line"><span>  │   ├── roles.controller.ts  # 包含 GET /roles/:id/users 等关联操作</span></span>
<span class="line"><span>  │   └── ...</span></span>
<span class="line"><span>  ├── auth/           # 认证特殊模块</span></span>
<span class="line"><span>  └── [resources]/    # 其他资源</span></span></code></pre></div><p><em>如果存在 <code>user-roles</code> 这种中间表模块，建议逻辑并入 <code>Roles</code> 或 <code>Users</code> 模块中作为子资源处理，物理上可保留 Service 拆分，但 API 层面应聚合。</em></p><hr><blockquote><p>此文档作为 <code>NestBase</code> 项目后端开发的最高准则。任何 Code Review 均应以此为依据。</p></blockquote>`,40)])])}const k=e(n,[["render",l]]);export{g as __pageData,k as default};
