import{_ as e,C as l,c as o,o as a,a0 as i,b as r,w as t,a as h,G as p,a1 as k}from"./chunks/framework.CHkYM5Ax.js";const y=JSON.parse('{"title":"前后端联调指南","description":"","frontmatter":{},"headers":[],"relativePath":"guides/INTEGRATION.zh-CN.md","filePath":"guides/INTEGRATION.zh-CN.md","lastUpdated":1767001922000}'),d={name:"guides/INTEGRATION.zh-CN.md"};function E(c,s,u,g,A,F){const n=l("Mermaid");return a(),o("div",null,[s[1]||(s[1]=i('<h1 id="前后端联调指南" tabindex="-1">前后端联调指南 <a class="header-anchor" href="#前后端联调指南" aria-label="Permalink to &quot;前后端联调指南&quot;">​</a></h1><p>本指南详细说明了 NestBase 项目中前端（Frontend）与后端（Backend）的交互机制，特别是核心的 <strong>认证与启动（Auth &amp; Bootstrap）</strong> 流程。</p><h2 id="核心交互流程" tabindex="-1">核心交互流程 <a class="header-anchor" href="#核心交互流程" aria-label="Permalink to &quot;核心交互流程&quot;">​</a></h2><h3 id="_1-登录与启动-login-bootstrap" tabindex="-1">1. 登录与启动 (Login &amp; Bootstrap) <a class="header-anchor" href="#_1-登录与启动-login-bootstrap" aria-label="Permalink to &quot;1. 登录与启动 (Login &amp; Bootstrap)&quot;">​</a></h3><p>为了提升用户体验并减少网络请求，我们在 v1.5.0 中引入了 <strong>聚合启动接口 (<code>/auth/bootstrap</code>)</strong>。</p><h4 id="流程图" tabindex="-1">流程图 <a class="header-anchor" href="#流程图" aria-label="Permalink to &quot;流程图&quot;">​</a></h4>',6)),(a(),r(k,null,{default:t(()=>[p(n,{id:"mermaid-18",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20User%0A%20%20%20%20participant%20Frontend%20as%20%E5%89%8D%E7%AB%AF%20(Store)%0A%20%20%20%20participant%20Backend%20as%20%E5%90%8E%E7%AB%AF%20(API)%0A%20%20%20%20participant%20DB%20as%20%E6%95%B0%E6%8D%AE%E5%BA%93%0A%0A%20%20%20%20User-%3E%3EFrontend%3A%20%E8%BE%93%E5%85%A5%E7%94%A8%E6%88%B7%E5%90%8D%2F%E5%AF%86%E7%A0%81%0A%20%20%20%20Frontend-%3E%3EBackend%3A%20POST%20%2Fauth%2Flogin%0A%20%20%20%20Backend--%3E%3EFrontend%3A%20%E8%BF%94%E5%9B%9E%20Token%20(AccessToken)%0A%0A%20%20%20%20rect%20rgb(240%2C%20248%2C%20255)%0A%20%20%20%20note%20right%20of%20Frontend%3A%20%E5%90%AF%E5%8A%A8%E9%98%B6%E6%AE%B5%20(Bootstrap)%0A%20%20%20%20Frontend-%3E%3EFrontend%3A%20%E5%AD%98%E5%82%A8%20Token%20(localStorage)%0A%20%20%20%20Frontend-%3E%3EBackend%3A%20GET%20%2Fauth%2Fbootstrap%20(%E6%90%BA%E5%B8%A6%20Token)%0A%20%20%20%20Backend-%3E%3EDB%3A%20%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2%20(%E7%94%A8%E6%88%B7%20%2B%20%E8%A7%92%E8%89%B2%20%2B%20%E6%9D%83%E9%99%90%20%2B%20%E8%8F%9C%E5%8D%95)%0A%20%20%20%20DB--%3E%3EBackend%3A%20%E8%BF%94%E5%9B%9E%E8%81%9A%E5%90%88%E6%95%B0%E6%8D%AE%0A%20%20%20%20Backend--%3E%3EFrontend%3A%20%E8%BF%94%E5%9B%9E%20%7B%20user%2C%20permissions%2C%20menus%20%7D%0A%20%20%20%20end%0A%0A%20%20%20%20Frontend-%3E%3EFrontend%3A%20AuthStore%3A%20%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%20%26%20%E6%9D%83%E9%99%90%0A%20%20%20%20Frontend-%3E%3EFrontend%3A%20RouteStore%3A%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%0A%20%20%20%20Frontend--%3E%3EUser%3A%20%E8%B7%B3%E8%BD%AC%E8%87%B3%E9%A6%96%E9%A1%B5%20%2F%20Dashboard%0A"})]),fallback:t(()=>[...s[0]||(s[0]=[h(" Loading... ",-1)])]),_:1})),s[2]||(s[2]=i(`<h4 id="关键接口" tabindex="-1">关键接口 <a class="header-anchor" href="#关键接口" aria-label="Permalink to &quot;关键接口&quot;">​</a></h4><h5 id="_1-1-登录接口" tabindex="-1">1.1 登录接口 <a class="header-anchor" href="#_1-1-登录接口" aria-label="Permalink to &quot;1.1 登录接口&quot;">​</a></h5><ul><li><strong>URL</strong>: <code>POST /api/auth/login</code></li><li><strong>作用</strong>: 验证凭据，获取 JWT Token。</li><li><strong>响应</strong>: <code>{ token: { accessToken, refreshToken, expiresIn } }</code></li></ul><h5 id="_1-2-启动接口-bootstrap" tabindex="-1">1.2 启动接口 (Bootstrap) <a class="header-anchor" href="#_1-2-启动接口-bootstrap" aria-label="Permalink to &quot;1.2 启动接口 (Bootstrap)&quot;">​</a></h5><ul><li><strong>URL</strong>: <code>GET /api/auth/bootstrap</code></li><li><strong>作用</strong>: 一次性获取应用初始化所需的所有数据。</li><li><strong>响应结构</strong>:</li></ul><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;code&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 用户基本信息 (含 roles)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;permissions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 权限代码列表 (如 &quot;user.create&quot;)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;menus&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 菜单与路由信息</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;routes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 动态路由树</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;home&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;root&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 默认首页路由名称</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_2-状态管理同步" tabindex="-1">2. 状态管理同步 <a class="header-anchor" href="#_2-状态管理同步" aria-label="Permalink to &quot;2. 状态管理同步&quot;">​</a></h3><p>前端使用 <strong>Pinia</strong> 进行状态管理，主要涉及以下两个 Store 的协同：</p><h4 id="auth-store-apps-frontend-src-store-modules-auth" tabindex="-1">Auth Store (<code>apps/frontend/src/store/modules/auth</code>) <a class="header-anchor" href="#auth-store-apps-frontend-src-store-modules-auth" aria-label="Permalink to &quot;Auth Store (\`apps/frontend/src/store/modules/auth\`)&quot;">​</a></h4><ul><li><strong>职责</strong>: 管理用户身份、Token、权限列表。</li><li><strong>核心动作</strong>: <code>initUserInfo()</code><ul><li>调用 <code>/auth/bootstrap</code>。</li><li>将 <code>user</code> 和 <code>permissions</code> 存入 state。</li><li>将 <code>menus</code> 数据传递给 <strong>Route Store</strong>。</li></ul></li></ul><h4 id="route-store-apps-frontend-src-store-modules-route" tabindex="-1">Route Store (<code>apps/frontend/src/store/modules/route</code>) <a class="header-anchor" href="#route-store-apps-frontend-src-store-modules-route" aria-label="Permalink to &quot;Route Store (\`apps/frontend/src/store/modules/route\`)&quot;">​</a></h4><ul><li><strong>职责</strong>: 管理路由表、侧边栏菜单、面包屑。</li><li><strong>核心动作</strong>: <code>initAuthRoute(menus)</code><ul><li>接收从 <code>Auth Store</code> 传递来的 <code>menus</code> 数据。</li><li><strong>不再</strong> 单独调用 <code>/user/routes</code> 接口（优化点）。</li><li>根据 <code>menus.routes</code> 生成 Vue Router 路由表并动态添加。</li></ul></li></ul><h2 id="开发注意事项" tabindex="-1">开发注意事项 <a class="header-anchor" href="#开发注意事项" aria-label="Permalink to &quot;开发注意事项&quot;">​</a></h2><h3 id="_1-请求超时设置" tabindex="-1">1. 请求超时设置 <a class="header-anchor" href="#_1-请求超时设置" aria-label="Permalink to &quot;1. 请求超时设置&quot;">​</a></h3><p>由于后端服务器（Supabase）位于境外，物理延迟较高，前端请求超时时间已调整为 <strong>30秒</strong>。</p><ul><li>配置文件: <code>apps/frontend/src/service/request/index.ts</code></li></ul><h3 id="_2-路由守卫优化" tabindex="-1">2. 路由守卫优化 <a class="header-anchor" href="#_2-路由守卫优化" aria-label="Permalink to &quot;2. 路由守卫优化&quot;">​</a></h3><ul><li><strong>避免重复请求</strong>: <code>onRouteSwitchWhenLoggedIn</code> 钩子中已移除 <code>initUserInfo()</code> 调用，防止每次点击菜单都触发生效。数据仅在<strong>登录时</strong>和<strong>页面刷新时</strong>同步。</li></ul><h3 id="_3-类型定义" tabindex="-1">3. 类型定义 <a class="header-anchor" href="#_3-类型定义" aria-label="Permalink to &quot;3. 类型定义&quot;">​</a></h3><p>前端 API 类型定义位于 <code>apps/frontend/src/typings/api.d.ts</code>。修改后端 DTO 后，请务必同步更新前端类型。</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// apps/frontend/src/typings/api.d.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">declare</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> namespace</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Api</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  namespace</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Auth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BootstrapData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      permissions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[];</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      menus</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        routes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ElegantConstRoute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[];</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        home</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LastLevelRouteKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div>`,21))])}const m=e(d,[["render",E]]);export{y as __pageData,m as default};
